{"version":3,"file":"evrythng.polyfill.js","sources":["../src/settings.js","../node_modules/lodash-es/_freeGlobal.js","../node_modules/lodash-es/_root.js","../node_modules/lodash-es/_Symbol.js","../node_modules/lodash-es/_getRawTag.js","../node_modules/lodash-es/_objectToString.js","../node_modules/lodash-es/_baseGetTag.js","../node_modules/lodash-es/_overArg.js","../node_modules/lodash-es/_getPrototype.js","../node_modules/lodash-es/isObjectLike.js","../node_modules/lodash-es/isPlainObject.js","../src/setup.js","../node_modules/lodash-es/isObject.js","../node_modules/lodash-es/isFunction.js","../src/util/buildParams.js","../src/util/buildUrl.js","../src/api.js","../node_modules/lodash-es/isArray.js","../node_modules/lodash-es/isString.js","../src/symbols.js","../src/scope/Scope.js","../node_modules/regenerator-runtime/runtime.js","../node_modules/regenerator-runtime/runtime-module.js","../node_modules/babel-runtime/regenerator/index.js","../src/util/parseLinkHeader.js","../src/resource/Resource.js","../src/entity/Entity.js","../src/entity/Property.js","../src/util/getCurrentPosition.js","../node_modules/lodash-es/isUndefined.js","../src/entity/Action.js","../src/util/mixin.js","../src/entity/Product.js","../src/entity/Location.js","../src/entity/Thng.js","../src/entity/Collection.js","../src/entity/ActionType.js","../src/entity/Status.js","../src/entity/ReactorScript.js","../src/entity/ReactorSchedule.js","../src/entity/ReactorLog.js","../src/entity/Application.js","../src/entity/Project.js","../src/entity/Permission.js","../src/entity/Role.js","../src/entity/User.js","../src/entity/Task.js","../src/entity/Batch.js","../src/entity/Place.js","../src/entity/File.js","../src/scope/Operator.js","../src/scope/User.js","../src/entity/UserAccess.js","../src/scope/Application.js","../src/scope/TrustedApplication.js","../src/scope/Device.js","../src/entities.js","../src/evrythng.js"],"sourcesContent":["/**\n * An interceptor implements a request and/or response handlers that are called\n * before and after each request, respectively.\n *\n * @typedef {Object} Interceptor\n * @param {Function} request - Function to run before the request is sent\n * @param {Function} response - Function to run after the response is received\n */\n\n/**\n * Settings can be applied globally or for individual requests.\n * Available options are provided below:\n *\n * @typedef {Object} Settings\n * @param {string} apiUrl - API url of request\n * @param {string} url - Url relative to `apiUrl`\n * @param {string} method - HTTP Method of request\n * @param {string} apiKey - API Key to use with request\n * @param {boolean} fullResponse - Flags if request should remain unwrapped\n * @param {boolean} geolocation - Flags if action creation should use the Web\n * Geolocation API\n * @param {number} timeout - Timeout for request\n * @param {Object} headers - Headers to send with request\n * @param {Interceptor[]} interceptors - List of request/response interceptors\n */\n\n/**\n * Default settings. Never change.\n *\n * @type {Settings}\n */\nconst defaultSettings = {\n  apiUrl: 'https://api.evrythng.com',\n  apiKey: '',\n  fullResponse: false,\n  geolocation: true,\n  timeout: 0,\n  headers: {\n    'content-type': 'application/json'\n  },\n  interceptors: []\n}\n\n// Initialize settings with defaults.\nconst settings = Object.assign({}, defaultSettings)\n\nexport default settings\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","import isPlainObject from 'lodash-es/isPlainObject'\nimport settings from './settings'\n\n/**\n * Override global settings. Ignore unknown settings.\n *\n * @param {Object} customSettings - Custom settings\n * @returns {Object} new\n */\nexport default function setup (customSettings) {\n  if (!isPlainObject(customSettings)) {\n    throw new TypeError('Setup should be called with an options object.')\n  }\n\n  // Update and return new settings.\n  return Object.assign(settings, customSettings)\n}\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import isPlainObject from 'lodash-es/isPlainObject'\n\nconst SPECIALS = ['&', '|', '!', '>', '<', '=', '~', '(', ')', ',']\nconst SPECIALS_REGEXP = new RegExp(`[${SPECIALS.join('\\\\')}]`, 'g')\nconst SPECIALS_ESCAPE = '\\\\$&'\n\n/**\n * Build url safe parameter string if an object provided.\n *\n * @export\n * @param {(Object | string)} [params] key-value object or final query string\n * @param {boolean} [useEncoding] whether to skip encoding\n * @returns {string}\n */\nexport default function buildParams (params = {}, useEncoding = true) {\n  return isPlainObject(params)\n    ? Object.entries(params).map(buildParam(useEncoding)).join('&')\n    : params\n}\n\n/**\n * Returns reducer function that adds the encoded key-value params to\n * accumulator.\n *\n * @param {boolean} useEncoding\n * @returns {Function}\n */\nfunction buildParam (useEncoding) {\n  const encode = uriEncoder(useEncoding)\n  return ([key, value]) => {\n    return `${encode(key)}=${encode(buildParams(value))}`\n  }\n}\n\n/**\n * Returns function that encodes values using encodeURIComponent.\n *\n * @param {boolean} useEncoding\n * @returns {Function}\n */\nfunction uriEncoder (useEncoding) {\n  return (value) => useEncoding\n    ? encodeURIComponent(value)\n    : escapeSpecials(value)\n}\n\n/**\n * Escape special characters in value with the backslash (\\) character.\n *\n * @param {string} value\n * @returns {string}\n */\nfunction escapeSpecials (value) {\n  return value.replace(SPECIALS_REGEXP, SPECIALS_ESCAPE)\n}\n","import buildParams from './buildParams'\n\n/**\n * Concatenate url with parameters from request options.\n *\n * @export\n * @param {Object} options request options including url and params\n * @returns {string}\n */\nexport default function buildUrl (options) {\n  let url = `${options.apiUrl}${options.url}`\n\n  if (options.params) {\n    url += `?${buildParams(options.params)}`\n  }\n\n  return url\n}\n","import isFunction from 'lodash-es/isFunction'\nimport settings from './settings'\nimport buildUrl from './util/buildUrl'\n\n/**\n * Make API request to provided API Url. Custom user options are merged with\n * the globally defined settings and request defaults. Request interceptors can\n * manipulated this options before passing them on to Fetch. On response,\n * response interceptors may parse the result.\n *\n * This method returns both a Promise and accepts error first callbacks.\n *\n * @param {Settings} customOptions - User options for this single request\n * @param {function} callback - Error first callback\n * @returns {Promise} - Response promise\n */\nexport default function api (customOptions = {}, callback) {\n  let initialOptions = mergeInitialOptions(customOptions)\n\n  return applyRequestInterceptors(initialOptions)\n    .then(options => {\n      return makeFetch(options)\n        .then(handleResponse(options))\n        .then(applyResponseInterceptors(options))\n    })\n    .then(success(callback))\n    .catch(failure(callback))\n}\n\n/**\n * Merge base options, global settings, one-off request options and nested\n * headers object. Use apiKey option if headers.authorization is not provided.\n *\n * @param {Settings} customOptions - User options\n * @returns {Settings} - Merged options for fetch\n */\nfunction mergeInitialOptions (customOptions) {\n  const options = Object.assign(\n    { method: 'get', url: '' },\n    settings,\n    customOptions,\n    { headers: Object.assign({}, settings.headers, customOptions.headers) }\n  )\n\n  // Use apiKey if authorization header is not explicitly provided.\n  if (!options.headers.authorization && options.apiKey) {\n    options.headers.authorization = options.apiKey\n  }\n\n  // Stringify data if any\n  if (options.data) {\n    options.body = JSON.stringify(options.data)\n    Reflect.deleteProperty(options, 'data')\n  }\n\n  return options\n}\n\n/**\n * Apply request inteceptors functions in sequence, chaining each promise.\n *\n * @param {Settings} options - Request options\n * @returns {Promise} - Promise to updated request options\n */\nfunction applyRequestInterceptors (options) {\n  // Use closure to keep track if request as been cancelled in interceptors\n  let cancelled = false\n  function cancel () {\n    cancelled = true\n  }\n\n  let intercepted = Promise.resolve(options)\n\n  if (Array.isArray(options.interceptors)) {\n    options.interceptors\n      .filter(interceptor => isFunction(interceptor.request))\n      .forEach(interceptor => {\n        // Chain promises. If interceptor returns undefined, use previous options\n        intercepted = intercepted.then(prevOptions => {\n          if (cancelled) return prevOptions\n          return interceptor.request(prevOptions, cancel) || prevOptions\n        })\n      })\n  }\n\n  return intercepted.then(finalOptions => {\n    // Reject request if it has been cancelled by request interceptors.\n    if (cancelled) {\n      return Promise.reject({\n        errors: ['Request cancelled on request interceptors'],\n        cancelled: true\n      })\n    }\n    return finalOptions\n  })\n}\n\n/**\n * Make the actual fetch request using the Fetch API (browser and Node.js).\n * Mimic timeout with Promise.race, rejecting request if timeout happens before\n * response arrives.\n * Note: timeout should be added to fetch spec:\n * https://github.com/whatwg/fetch/issues/20\n *\n * @param {Settings} options - Request options\n */\nfunction makeFetch (options) {\n  const req = fetch(buildUrl(options), options)\n  if (!options.timeout) {\n    return req\n  } else {\n    return Promise.race([\n      req,\n      new Promise(function (resolve, reject) {\n        setTimeout(() => reject('Request timeout'), options.timeout)\n      })\n    ])\n  }\n}\n\n/**\n * Return initial response data depending on the options.fullResponse value.\n * Always resolve request on HTTP success code, reject otherwise. Return the\n * entire Response object in case of fullResponse option, default to JSON\n * parsing otherwise.\n *\n * @param {Settings} options - Request options\n * @returns {Promise} - Promise to {Response} or {Object}\n */\nfunction handleResponse (options) {\n  return response => {\n    const res = options.fullResponse\n      ? Promise.resolve(response)\n      : response.status === 204\n      ? Promise.resolve()\n      : response.json()\n\n    return res.then(data => {\n      if (response.ok) {\n        return data\n      } else {\n        throw data\n      }\n    })\n  }\n}\n\n/**\n * Apply response interceptors functions. When using fullResponse, response is\n * a Response object with a ReadableStream. Until transform streams arrive in\n * browser, there's no way to elegantly transform a response body, other than\n * monkey-patching .json method.\n *\n * @param {Settings} options - Request options\n * @returns {function} - Response handler function\n */\nfunction applyResponseInterceptors (options) {\n  return response => {\n    let intercepted = Promise.resolve(response)\n\n    if (Array.isArray(options.interceptors)) {\n      options.interceptors\n        .filter(interceptor => isFunction(interceptor.response))\n        .forEach(interceptor => {\n          // Chain promises.\n          intercepted = intercepted.then(interceptor.response)\n        })\n    }\n\n    return intercepted\n  }\n}\n\n/**\n * Apply error-first callback if available.\n *\n * @param {function} callback - Error-first callback\n * @returns {function} - Response handler function\n */\nexport function success (callback) {\n  return response => {\n    if (callback) callback(null, response)\n    return response\n  }\n}\n\n/**\n * Apply error-first callback with error if available.\n *\n * @param {function} callback - Error-first callback\n * @returns {function} - Response handler function\n */\nexport function failure (callback) {\n  return err => {\n    if (callback) callback(err)\n    throw err\n  }\n}\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","import baseGetTag from './_baseGetTag.js';\nimport isArray from './isArray.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar stringTag = '[object String]';\n\n/**\n * Checks if `value` is classified as a `String` primitive or object.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a string, else `false`.\n * @example\n *\n * _.isString('abc');\n * // => true\n *\n * _.isString(1);\n * // => false\n */\nfunction isString(value) {\n  return typeof value == 'string' ||\n    (!isArray(value) && isObjectLike(value) && baseGetTag(value) == stringTag);\n}\n\nexport default isString;\n","export default {\n  init: Symbol('init'),\n  path: Symbol('path'),\n  resource: Symbol('resource')\n}\n","import isString from 'lodash-es/isString'\nimport api from '../api'\nimport symbols from '../symbols'\n\n/**\n * Scope defines the context in which API calls are made. A scope is defined\n * by its API Key. That key is sent in each request's Authorization header that\n * uses this scope.\n */\nexport default class Scope {\n  /**\n   * Creates an instance of Scope.\n   *\n   * @param {string} apiKey API Key of scope\n   * @param {Object} [body={}] Optional scope data\n   */\n  constructor (apiKey, body = {}) {\n    if (!isString(apiKey)) {\n      throw new Error('Scope constructor should be called with an API Key')\n    }\n\n    this.apiKey = apiKey\n\n    // Define non-enumerable unique init property so it's not copied over in\n    // shallow copies of this (e.g. using Object.assign).\n    this[symbols.init] = api({\n      url: '/access',\n      apiKey: this.apiKey\n    })\n\n    // Extend scope with any given details.\n    Object.assign(this, body)\n  }\n\n  /**\n   * Read itself and extend scope document.\n   *\n   * @param {Settings} [options={}] - Optional API request options\n   * @returns {Promise} - Updated operator scope\n   */\n  read (options = {}) {\n    const opts = Object.assign(options, {\n      method: 'get',\n      url: this[symbols.path],\n      apiKey: this.apiKey\n    })\n\n    return this._request(opts)\n  }\n\n  /**\n   * Update self and extend scope document.\n   *\n   * @param {Object} data - Operator data\n   * @param {Settings} [options={}] - Optional API request options\n   * @returns {Promise} - Updated operator scope\n   */\n  update (data, options = {}) {\n    const opts = Object.assign(options, {\n      method: 'put',\n      url: this[symbols.path],\n      apiKey: this.apiKey,\n      data\n    })\n\n    return this._request(opts)\n  }\n\n  // Private\n\n  /**\n   *\n   * @param {Settings} options - Request options\n   * @returns {Promise} - Updated operator scope\n   * @private\n   */\n  _request (options) {\n    return api(options).then(data => Object.assign(this, data))\n  }\n}\n","/**\n * Copyright (c) 2014, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * https://raw.github.com/facebook/regenerator/master/LICENSE file. An\n * additional grant of patent rights can be found in the PATENTS file in\n * the same directory.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    if (typeof global.process === \"object\" && global.process.domain) {\n      invoke = global.process.domain.bind(invoke);\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        if (delegate.iterator.return) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // Among the various tricks for obtaining a reference to the global\n  // object, this seems to be the most reliable technique that does not\n  // use indirect eval (which violates Content Security Policy).\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this\n);\n","// This method of obtaining a reference to the global object needs to be\n// kept identical to the way it is obtained in runtime.js\nvar g =\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this;\n\n// Use `getOwnPropertyNames` because not all browsers support calling\n// `hasOwnProperty` on the global `self` object in a worker. See #183.\nvar hadRuntime = g.regeneratorRuntime &&\n  Object.getOwnPropertyNames(g).indexOf(\"regeneratorRuntime\") >= 0;\n\n// Save the old regeneratorRuntime in case it needs to be restored later.\nvar oldRuntime = hadRuntime && g.regeneratorRuntime;\n\n// Force reevalutation of runtime.js.\ng.regeneratorRuntime = undefined;\n\nmodule.exports = require(\"./runtime\");\n\nif (hadRuntime) {\n  // Restore the original runtime.\n  g.regeneratorRuntime = oldRuntime;\n} else {\n  // Remove the global property added by runtime.js.\n  try {\n    delete g.regeneratorRuntime;\n  } catch(e) {\n    g.regeneratorRuntime = undefined;\n  }\n}\n","module.exports = require(\"regenerator-runtime\");\n","// Parse Link headers for API pagination.\n// https://gist.github.com/niallo/3109252\nexport default function parseLinkHeader (header) {\n  const links = {}\n\n  if (header && header.length) {\n    // Split parts by comma\n    const parts = header.split(',')\n    // Parse each part into a named link\n    for (let i = 0; i < parts.length; i++) {\n      const section = parts[i].split(';')\n      const url = section[0].replace(/<(.*)>/, '$1').trim()\n      const name = section[1].replace(/rel=\"(.*)\"/, '$1').trim()\n      links[name] = url\n    }\n  }\n\n  return links\n}\n","import isString from 'lodash-es/isString'\nimport isFunction from 'lodash-es/isFunction'\nimport Scope from '../scope/Scope'\nimport Entity from '../entity/Entity'\nimport api, { success, failure } from '../api'\nimport symbols from '../symbols'\nimport parseLinkHeader from '../util/parseLinkHeader'\n\n/**\n * A Resource is the base class that implements the CRUD methods behavior.\n * All resource requests are scoped (i.e. they use the scope's API Key).\n *\n * Every resource operation tries to serialize/deserialize the type of object\n * corresponding to the resource (i.e. when creating a Thng, the developer gets\n * a Thng entity back, with nested methods).\n */\nexport default class Resource {\n  /**\n   * Returns a resource factory function for the given entity type.\n   *\n   * @static\n   * @param {Entity} type - Entity sub-class\n   * @param {string} path - Path for new resource\n   * @param {Function} MixinNestedResources - Mixin that extends Resource class\n   * with nested resources\n   * @return {Function} - Resource factory function\n   */\n  static factoryFor (type, path = '', MixinNestedResources) {\n    if (!type) {\n      throw new Error('Entity type is necessary for resource factory.')\n    }\n\n    // No \"this\" binding with arrow function! This needs to run in the context\n    // where it is mixed in / attached.\n    return function (id) {\n      // Allowed on Scopes, Resources and Entities.\n      let parentPath, parentScope, newPath\n\n      if (this instanceof Scope) {\n        parentScope = this\n        parentPath = ''\n      } else if (this instanceof Resource) {\n        parentScope = this.scope\n        parentPath = this.path\n      } else if (this instanceof Entity) {\n        parentScope = this[symbols.resource].scope\n        parentPath = this[symbols.resource].path\n      }\n\n      newPath = parentPath + path\n\n      if (id) {\n        if (!isString(id)) {\n          throw new TypeError('ID must be a string.')\n        }\n        newPath += `/${encodeURIComponent(id)}`\n      }\n\n      const XResource = MixinNestedResources\n        ? MixinNestedResources(Resource)\n        : Resource\n      return new XResource(parentScope, newPath, type)\n    }\n  }\n\n  /**\n   * A Resource requires a Scope sub-class (App, Operator, etc.) and the\n   * corresponding path in the Engine API. An Entity sub-class can be\n   * provided, in which case is it used to create instance of that Entity class\n   * when returning from API requests.\n   *\n   * @param {Scope} scope - Scope containing API Key\n   * @param {string} path - Relative path to API resource\n   * @param {Entity} [type] - Reference to Entity class (constructor)\n   */\n  constructor (scope, path, type) {\n    if (!(scope && scope instanceof Scope)) {\n      throw new TypeError('Scope should inherit from Scope (e.g. EVT.App).')\n    }\n\n    if (!isString(path)) {\n      throw new TypeError('Resource must have a String path.')\n    }\n\n    // Setup scope for each of the subsequent calls.\n    this.scope = scope\n\n    // Setup path and allow to omit leading '/'.\n    this.path = `${path[0] !== '/' ? '/' : ''}${path}`\n\n    // Setup entity for serializing and deserializing results. It must\n    // implement *toJSON()* method, as defined in the Entity base class.\n    if (type && (type === Entity || type.prototype instanceof Entity)) {\n      this.type = type\n    }\n  }\n\n  /**\n   * Convert an Entity instance into plain JSON payload for API requests.\n   *\n   * @param {Entity} entity - Instace of entity object\n   * @returns {Object}\n   */\n  serialize (entity = {}) {\n    if (!(this.type && entity instanceof this.type)) {\n      return entity\n    }\n    return entity.json()\n  }\n\n  /**\n   * Opposite of serialization. Convert API responses into proper Entities\n   * using the entity class of the resource. If response is a collection,\n   * converts each of the items.\n   *\n   * @param {Object} response - JSON response from API\n   * @returns {Object|Entity|Response} - Entity if able to deserialize;\n   * Response if fullResponse option was used; Object otherwise.\n   */\n  deserialize (response) {\n    if (response && this.type) {\n      if (Array.isArray(response)) {\n        return response.map(this.deserialize.bind(this))\n      }\n\n      if (response.body) {\n        // Full response, add deserialize method to deserialize the Response's\n        // json body\n        response.deserialize = () => response.json()\n          .then(this.deserialize.bind(this))\n      } else {\n        // JSON response, base case.\n        // Create new entity with updated resource derived from current.\n        let newPath = this.path\n\n        // Expand resource path with ID of entity.\n        if (response.id && newPath.indexOf(response.id) === -1) {\n          newPath += `/${response.id}`\n        }\n\n        const newResource = new Resource(this.scope, newPath, this.type)\n        const EntityType = this.type\n        return new EntityType(newResource, response)\n      }\n    }\n\n    return response\n  }\n\n  /**\n   * Create a new entity for this resource.\n   *\n   * @param {Object|Entity} body - Entity to create\n   * @param {Settings} [options] - Options of the request\n   * @param {Function} [callback] - Error-first callback\n   * @returns {Promise}\n   */\n  create (body, options, callback) {\n    if (!body || isFunction(body)) {\n      throw new TypeError('Create method must have payload.')\n    }\n\n    return this._request({\n      url: this.path,\n      body,\n      method: 'post'\n    }, options, callback)\n  }\n\n  /**\n   * Reads resource entities.\n   *\n   * @param {Settings} [options] - Options of the request\n   * @param {Function} [callback] - Error-first callback\n   * @returns {Promise}\n   */\n  read (options, callback) {\n    return this._request({\n      url: this.path,\n      method: 'get'\n    }, options, callback)\n  }\n\n  /**\n   * Updates entity via this resource.\n   *\n   * @param {Object|Entity} body - Entity to create\n   * @param {Settings} [options] - Options of the request\n   * @param {Function} [callback] - Error-first callback\n   * @returns {Promise}\n   */\n  update (body, options, callback) {\n    if (!body || isFunction(body)) {\n      throw new TypeError('Update method must have payload.')\n    }\n\n    return this._request({\n      url: this.path,\n      body,\n      method: 'put'\n    }, options, callback)\n  }\n\n  /**\n   * Deletes entity in resource.\n   *\n   * @param {Settings} [options] - Options of the request\n   * @param {Function} [callback] - Error-first callback\n   * @returns {Promise}\n   */\n  ['delete'] (options, callback) {\n    return this._request({\n      url: this.path,\n      method: 'delete'\n    }, options, callback)\n  }\n\n  /**\n   * Returns a page iterator. It is essentially an async generator that returns\n   * a promise to the next page on every `.next()` invocation.\n   *\n   * @param {Settings} [options] - Options of the request\n   * @returns {AsyncGenerator}\n   * @example\n   *\n   * ```\n   *   const it = operator.thng().pages()\n   *   it.next().then(console.log)\n   *\n   *   // or in ES7+\n   *\n   *   for await (let page of pages) {\n   *     console.log(page)\n   *   }\n   * ```\n   */\n  async *pages (options = {}) {\n    const fullResponse = options.fullResponse\n    let response\n\n    // Read first 'page' with user-defined options.\n    response = await this._linkRequest({url: this.path}, fullResponse, options)\n    yield response.result\n\n    while (response.next) {\n      response = await this._linkRequest({apiUrl: response.next}, fullResponse)\n      yield response.result\n    }\n  }\n\n  // PRIVATE\n\n  /**\n   * Actual request call. This method merges mandatory request options with\n   * user provided ones and forces the resource path and API Key, so they are\n   * not overriden. Serializes any body passed in, and deserializes response in\n   * the end.\n   *\n   * Callback may be used in place of userOptions.\n   *\n   * @param {Settings} requestOptions - Mandatory request options\n   * @param {Settings} [userOptions] - Optional user options\n   * @param {Function} [callback] - Error-first callback\n   * @returns {Promise.<Object|Entity|Response>}\n   * @private\n   */\n  async _request (requestOptions, userOptions = {}, callback) {\n    if (isFunction(userOptions)) {\n      callback = userOptions\n    }\n\n    // Merge options, priority to mandatory ones.\n    const options = Object.assign(\n      {},\n      userOptions,\n      requestOptions,\n      {\n        apiKey: this.scope.apiKey\n      }\n    )\n\n    // Serialize Entity into JSON payload.\n    if (options.body) {\n      options.body = await this.serialize(options.body)\n    }\n\n    // Execute callback after deserialization.\n    try {\n      const response = await api(options)\n      const deserialized = await this.deserialize(response)\n      return success(callback)(deserialized)\n    } catch (err) {\n      throw failure(callback)(err)\n    }\n  }\n\n  /**\n   * Async request that parses the link header if any.\n   *\n   * @param {Settings} requestOptions - Mandatory request options\n   * @param {Boolean} fullResponse - Wrap Response or not\n   * @param {Settings} [userOptions] - Optional user options\n   * @returns {Promise.<{result: Response|Array, next: string}>}\n   * @private\n   */\n  async _linkRequest (requestOptions, fullResponse, userOptions = {}) {\n    const opts = Object.assign({ fullResponse: true }, requestOptions)\n    const response = await this._request(opts, userOptions)\n    const linkHeader = parseLinkHeader(response.headers.get('link'))\n    const next = linkHeader.next && decodeURIComponent(linkHeader.next)\n    const result = await (fullResponse ? response : response.json())\n    return { result, next }\n  }\n}\n","import Resource from '../resource/Resource'\nimport symbols from '../symbols'\n\n/**\n * Entity is the base class for all types of entities in the EVRYTHNG API.\n * An Entity knows how to update and delete itself given that a resource is\n * provided.\n */\nexport default class Entity {\n  /**\n   * Creates an new entity of given Resource. Optionally can be initialized\n   * with pre-defined data.\n   *\n   * @param {Resource} resource - Resource owner of this entity.\n   * @param {Object} [body] Optional entity data\n   */\n  constructor (resource, body = {}) {\n    if (!(resource && resource instanceof Resource)) {\n      throw new Error('Resource must be a Resource.')\n    }\n\n    // Define non-enumerable unique resource property so it's not copied over\n    // in shallow copies of this (e.g. using Object.assign).\n    this[symbols.resource] = resource\n\n    // Extend Entity with data.\n    Object.assign(this, body)\n  }\n\n  /**\n   * Returns all enumerable properties.\n   *\n   * @returns {Object}\n   */\n  json () {\n    return Object.entries(this)\n      .reduce((ret, [k, v]) => Object.assign(ret, {[k]: v}), {})\n  }\n\n  /**\n   * Update itself by calling the update method of the owning resource and\n   * passing the JSON representation of itself or the given body object.\n   *\n   * @param {Object} body - optional body, use self as default\n   * @param {Function} callback - error-first callback\n   * @returns {Promise.<Object>}\n   */\n  update (body = this.json(), callback) {\n    return this[symbols.resource].update(body, callback)\n      .then(updated => {\n        // Update self and keep chaining with API response.\n        Object.assign(this, updated)\n        return updated\n      })\n  }\n\n  /**\n   * Delete itself by calling the delete method of the owning resource.\n   *\n   * @param {Function} callback - error-first callback\n   * @returns {Promise.<Object>}\n   */\n  ['delete'] (callback) {\n    return this[symbols.resource].delete(callback)\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport symbols from '../symbols'\nimport isString from 'lodash-es/isString'\nimport isPlainObject from 'lodash-es/isPlainObject'\n\nconst path = '/properties'\n\n/**\n * Represents a Property entity. Properties are always nested and required\n * to be constructed on Resource/Entity objects (not top level Scopes).\n *\n * @extends Entity\n */\nexport default class Property extends Entity {\n  /**\n   * Return overridden resource factory for Properties. Properties are\n   * sub-resources of Thngs and Products and are not allowed on top level\n   * Scope classes. This factory also override the default Resource's create\n   * and update methods to accept and normalize different types of arguments.\n   *\n   * @static\n   * @return {{property: Function}}\n   */\n  static resourceFactory () {\n    return {\n      property (id) {\n        const thngPath = this instanceof Scope ? this[symbols.path] : ''\n\n        // Creates and returns Resource of type Property.\n        // Override property resource create/update to allow custom value\n        // params. See `normalizeArguments()`.\n        return Object.assign(\n          Resource.factoryFor(Property, thngPath + path).call(this, id),\n          {\n            create (...args) {\n              return Resource.prototype.create\n                .call(this, ...normalizeArguments(...args))\n            },\n            update (...args) {\n              return Resource.prototype.update\n                .call(this, ...normalizeArguments(...args))\n            }\n          }\n        )\n      }\n    }\n  }\n}\n\n/**\n * The API only allows array format for property updates. The SDK relaxed that\n * and allows developers to pass in simple strings, numbers, booleans and objects.\n * It also allows to pass multiple key-value updates in a single object.\n *\n * @param {*} data - Property data.\n * @param {*} rest - Rest of parameters.\n * @return {Array} - Same input format, with first data param updated.\n * @example\n *\n * product.property().update({\n *   on: true,\n *   temp: 26,\n *   custom: ['1', '2']\n * })\n */\nfunction normalizeArguments (data, ...rest) {\n  if (\n    isString(data) ||\n    typeof data === 'number' ||\n    typeof data === 'boolean'\n  ) {\n    // Convert simple property values to API format.\n    data = [{ value: data }]\n  } else if (isPlainObject(data)) {\n    if (data.hasOwnProperty('value')) {\n      // Update single property using object notation.\n      data = [data]\n    } else {\n      // Update multiple properties creating an object for each key-value pair.\n      data = Object.entries(data).map(val => ({\n        key: val[0],\n        value: val[1]\n      }))\n    }\n  }\n\n  return [data, ...rest]\n}\n","/**\n * Get browser's current position from Geolocation API.\n *\n * @return {Promise} - Resolves with current position or rejects with failure\n * explanation.\n */\nexport default function getCurrentPosition () {\n  return new Promise((resolve, reject) => {\n    if (typeof window !== 'undefined' && window.navigator.geolocation) {\n      const geolocationOptions = {\n        maximumAge: 0,\n        timeout: 10000,\n        enableHighAccuracy: true\n      }\n\n      window.navigator.geolocation.getCurrentPosition(\n        resolve,\n        err => reject(err.message),\n        geolocationOptions\n      )\n    } else {\n      reject('Geolocation API not available.')\n    }\n  })\n}\n","/**\n * Checks if `value` is `undefined`.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.\n * @example\n *\n * _.isUndefined(void 0);\n * // => true\n *\n * _.isUndefined(null);\n * // => false\n */\nfunction isUndefined(value) {\n  return value === undefined;\n}\n\nexport default isUndefined;\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport settings from '../settings'\nimport symbols from '../symbols'\nimport getCurrentPosition from '../util/getCurrentPosition'\nimport isString from 'lodash-es/isString'\nimport isFunction from 'lodash-es/isFunction'\nimport isUndefined from 'lodash-es/isUndefined'\n\nconst path = '/actions/:type'\n\n/**\n * Represents an Action entity.\n *\n * @extends Entity\n */\nexport default class Action extends Entity {\n  /**\n   * Return overridden resource factory for Actions. Actions require an\n   * action type to be specified before the ID. The action creation is also\n   * different from any other Resource, as it fetches the user location and\n   * pre-populates the action payload with the Resource type.\n   *\n   * @static\n   * @return {{action: Function}}\n   */\n  static resourceFactory () {\n    return {\n      action (actionType, id) {\n        if (!actionType) {\n          throw new TypeError('Action type cannot be empty.')\n        }\n\n        if (!isString(actionType)) {\n          throw new TypeError('Action type must be a name string')\n        }\n\n        const typePath = path.replace(':type', actionType)\n        const thngPath = this instanceof Scope ? this[symbols.path] : ''\n        const context = this\n\n        // Creates and returns Resource of type Action.\n        // Override property resource create to allow custom value params and\n        // fetch the user's geolocation. See `createAction()`.\n        return Object.assign(\n          Resource.factoryFor(Action, thngPath + typePath).call(this, id),\n          {\n            create (...args) {\n              return createAction.call(this, context, actionType, ...args)\n            }\n          }\n        )\n      }\n    }\n  }\n}\n\n/**\n * Create action of given type. Allow empty body and fetch geolocation if\n * setup and available.\n *\n * @param {Scope|Resource|Entity} caller - Where the resource is attached to\n * @param {string} actionType - Type of action\n * @param {*} args - Rest of arguments passed to resource creation\n * @return {Promise}\n */\nfunction createAction (caller, actionType, ...args) {\n  let [data, ...rest] = normalizeArguments(...args)\n  let [options] = rest\n\n  // Auto-fill action payload with resource type and entity id.\n  data = Array.isArray(data)\n    ? data.map(action => fillAction(action, caller, actionType))\n    : data = fillAction(data, caller, actionType)\n\n  const baseCreate = Resource.prototype.create.bind(this)\n  const updatedArgs = () => [data, ...rest]\n\n  if (useGeolocation(options)) {\n    return getCurrentPosition()\n      .then(position => {\n        data = fillActionLocation(data, position)\n        return baseCreate(...updatedArgs())\n      })\n      .catch(err => {\n        console.info(`Unable to get position: ${err}`)\n        return baseCreate(...updatedArgs())\n      })\n  } else {\n    return baseCreate(...updatedArgs())\n  }\n}\n\n/**\n * Add an empty action object if none is provided.\n *\n * @param {*} args - Arguments array.\n * @return {Array} - Same input format, with first data param updated.\n * @example\n *\n * product.action().create()\n * product.action().create(<Action>)\n */\nfunction normalizeArguments (...args) {\n  let firstArg = args[0]\n  if (isUndefined(firstArg) || isFunction(firstArg)) {\n    args.unshift({})\n  }\n  return args\n}\n\n/**\n * Fill action type and entity ID. Resource type takes precedence over given\n * type. Entity ID overrides any pre-defined target ID, if action is created on\n * an Entity instance.\n *\n * @param {Object} data - Action data\n * @param {Scope|Resource|Entity} caller - Where the resource is attached to\n * @param {string} actionType - Resource action type\n * @return {Object} - New action data\n */\nfunction fillAction (data, caller, actionType) {\n  const action = Object.assign({}, data)\n\n  // Fill type from Resource or pre-defined type.\n  action.type = actionType !== 'all' && actionType || data.type || ''\n\n  // Fill in entity ID if called on an entity.\n  const entityIdentifier = getIdentifier(caller)\n  if (entityIdentifier) {\n    action[entityIdentifier] = caller.id\n  }\n\n  return action\n}\n\n/**\n * Actions can be performed on Products, Thngs and Collections and the\n * property on the payload differs based on the target.\n *\n * @param {Scope|Resource|Entity} caller - Where the resource is attached to\n * @return {string}\n */\nfunction getIdentifier (caller) {\n  return caller instanceof Entity\n    ? caller.constructor.name.toLocaleLowerCase()\n    : ''\n}\n\n/**\n * Check if the library should request the browser geolocation. If local\n * option is available, it takes precedence over global setting.\n *\n * @param {Settings|Function} options - If function, it's the callback\n * @return {boolean}\n */\nfunction useGeolocation (options) {\n  return options && !isUndefined(options.geolocation)\n    ? options.geolocation\n    : settings.geolocation\n}\n\n/**\n * Fill action location with coordinates from browser's Geolocation API.\n *\n * @param {Object} data - Action data\n * @param {Object} position - Geolocation API position coordinates\n * @return {Object} - New action data\n */\nfunction fillActionLocation (data, position) {\n  const action = Object.assign({}, data)\n  action.location = {\n    latitude: position.coords.latitude,\n    longitude: position.coords.longitude\n  }\n  action.locationSource = 'sensor'\n  return action\n}\n","/**\n * Return a subclass factory function that mixins the resource factory\n * functions from all the entities provided.\n * This provides a way to extend a Scope class and add a mixin that contains\n * all the resource methods available for that scope.\n *\n * E.g.\n * ```\n *  class Operator extends OperatorAccess(Scope) {}\n * ```\n *\n * See: http://raganwald.com/2015/12/28/mixins-subclass-factories-and-method-advice.html#fn:simplified\n *\n * @param {Array} entities - List of entities to add resources to\n * @return {function(Scope)}\n */\nexport function mixinResources (entities) {\n  const resourceFactories = entities.map(e => e.resourceFactory())\n  const accessResources = Object.assign({}, ...resourceFactories)\n  return Superclass => mixin(accessResources)(class extends Superclass {})\n}\n\n/**\n * Simplified mixin definition. Enough for our use case.\n * See: http://raganwald.com/2015/06/17/functional-mixins.html\n *\n * @param {Object} behaviour - Shared behaviour object literal\n * @param {Boolean} proto - Indicates if mixin should be applied to prototype\n * @return {function(target)}\n */\nexport default function mixin (behaviour, proto = true) {\n  return (target) => {\n    for (let property of Reflect.ownKeys(behaviour)) {\n      Object.defineProperty(\n        proto ? target.prototype : target,\n        property,\n        { value: behaviour[property] }\n      )\n    }\n    return target\n  }\n}\n","import Entity from './Entity'\nimport Property from './Property'\nimport Action from './Action'\nimport Resource from '../resource/Resource'\nimport { mixinResources } from '../util/mixin'\n\nconst path = '/products'\nconst ProductResources = mixinResources([\n  Property,\n  Action\n])\n\n/**\n * Represents a Product entity object.\n *\n * @extends Entity\n */\nexport default class Product extends ProductResources(Entity) {\n  /**\n   * Return simple resource factory for Products.\n   *\n   * @static\n   * @return {{product: Function}}\n   */\n  static resourceFactory () {\n    return {\n      product: Resource.factoryFor(Product, path, ProductResources)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport settings from '../settings'\nimport symbols from '../symbols'\nimport getCurrentPosition from '../util/getCurrentPosition'\nimport isUndefined from 'lodash-es/isUndefined'\nimport isFunction from 'lodash-es/isFunction'\nimport isPlainObject from 'lodash-es/isPlainObject'\nimport isString from 'lodash-es/isString'\n\nconst path = '/locations'\n\n/**\n * Represents a Location entity. Locations are always nested and required\n * to be constructed on Resource/Entity objects (not top level Scopes).\n *\n * @extends Entity\n */\nexport default class Location extends Entity {\n  /**\n   * Return overridden resource factory for Locations. Locations are\n   * sub-resources of Thngs and are not allowed on top level Scope classes.\n   * This factory also override the default Resource's update method to allow\n   * empty invocations that send the current browser's location as the payload.\n   *\n   * @static\n   * @return {{property: Function}}\n   */\n  static resourceFactory () {\n    return {\n      location () {\n        // Locations don't have single resource endpoint (e.g.: /locations/:id)\n        if (isString(arguments[0])) {\n          throw new TypeError('There is no single resource for Locations')\n        }\n\n        const thngPath = this instanceof Scope ? this[symbols.path] : ''\n\n        // Creates and returns Resource of type Location.\n        // Override property resource update to allow empty updates.\n        // See `updateLocation()`.\n        return Object.assign(\n          Resource.factoryFor(Location, thngPath + path).call(this),\n          {\n            update (...args) {\n              return updateLocation.call(this, ...args)\n            }\n          }\n        )\n      }\n    }\n  }\n}\n\n/**\n * Update locations given an array of new locations. If none is provided\n * it tries to use the current browser location for the update.\n *\n * @param {*} args - List of locations or nothing\n * @return {Promise}\n */\nfunction updateLocation (...args) {\n  let [data, ...rest] = normalizeArguments(...args)\n  const baseUpdate = Resource.prototype.update.bind(this)\n  const updatedArgs = () => [data, ...rest]\n\n  if (useGeolocation(data)) {\n    return getCurrentPosition()\n      .then(position => {\n        data[0] = fillLocation(data[0], position)\n        return baseUpdate(...updatedArgs())\n      })\n      .catch(err => {\n        console.info(`Unable to get position: ${err}`)\n        return baseUpdate(...updatedArgs())\n      })\n  } else {\n    return baseUpdate(...updatedArgs())\n  }\n}\n\n/**\n * Convert simple object to array. Add an empty location array if none is\n * provided.\n *\n * @param {*} args - Arguments array.\n * @return {Array} - Same input format, with first data param updated.\n * @example\n *\n * thng.location().update()\n * thng.location().update([<Location>])\n */\nfunction normalizeArguments (...args) {\n  let firstArg = args[0]\n  if (isPlainObject(firstArg)) {\n    args[0] = [firstArg]\n  } else if (isUndefined(firstArg) || isFunction(firstArg)) {\n    args.unshift([])\n  }\n  return args\n}\n\n/**\n * Use geolocation if no location was provided and global settings allow to use\n * geolocation.\n *\n * @param {Array} data - Data passed to the update (list of locations)\n * @return {boolean}\n */\nfunction useGeolocation (data) {\n  return data.length === 0 && settings.geolocation\n}\n\n/**\n * Fill location coordinates from browser's Geolocation API.\n *\n * @param {Object} data - Location data\n * @param {Object} position - Geolocation API position coordinates\n * @return {Object} - New location data\n */\nfunction fillLocation (data, position) {\n  const location = Object.assign({}, data)\n  location.position = {\n    type: 'Point',\n    coordinates: [position.coords.longitude, position.coords.latitude]\n  }\n  return location\n}\n","import Entity from './Entity'\nimport Property from './Property'\nimport Action from './Action'\nimport Location from './Location'\nimport Resource from '../resource/Resource'\nimport { mixinResources } from '../util/mixin'\n\nconst path = '/thngs'\nconst ThngResources = mixinResources([\n  Property,\n  Action,\n  Location\n])\n\n/**\n * Represents a Thng entity object.\n *\n * @extends Entity\n */\nexport default class Thng extends ThngResources(Entity) {\n  /**\n   * Return simple resource factory for Thngs.\n   *\n   * @static\n   * @return {{product: Function}}\n   */\n  static resourceFactory () {\n    return {\n      thng: Resource.factoryFor(Thng, path, ThngResources)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Thng from './Thng'\nimport Action from './Action'\nimport Resource from '../resource/Resource'\nimport mixin, { mixinResources } from '../util/mixin'\n\nconst path = '/collections'\nconst CollectionResources = mixinResources([\n  Thng,\n  Action\n  // Collection // Read explanation below.\n])\n\n/**\n * Represents a Collection entity object. Collection has nested Collections\n * sub-resources. The workaround for the circular dependency is to only add\n * the Collection resource mixin after the class definition. This is different\n * than baking it in the parent Class Expression mixin\n * (i.e. CollectionResources) as the method is attached to the Collection\n * prototype, rather than the extended Entity class. Though, given the JS\n * prototype chain, there is no difference for the end user.\n *\n * @extends Entity\n */\nexport default class Collection extends CollectionResources(Entity) {\n  /**\n   * Return simple resource factory for Collections.\n   *\n   * @static\n   * @return {{collection: Function}}\n   */\n  static resourceFactory () {\n    return {\n      collection (id) {\n        // Explicitly add Collection resource mixin to nested resource.\n        return Object.assign(\n          Resource.factoryFor(Collection, path, CollectionResources)\n            .call(this, id),\n          Collection.resourceFactory()\n        )\n      }\n    }\n  }\n}\n\n// Explicitly add Collection resource mixin to Collection.\nmixin(Collection.resourceFactory())(Collection)\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport isFunction from 'lodash-es/isFunction'\nimport isUndefined from 'lodash-es/isUndefined'\n\nconst path = '/actions'\n\n/**\n * Represents an ActionType entity. Action types endpoint it weird as it\n * overlaps with the Actions (/actions), so there is a normalization necessary\n * on the read method.\n *\n * @extends Entity\n */\nexport default class ActionType extends Entity {\n  /**\n   * Return overridden resource factory for ActionsTypes. Read method needs to\n   * use a filter as there is no single action type resource endpoint.\n   *\n   * @static\n   * @return {{actionType: Function}}\n   */\n  static resourceFactory () {\n    return {\n      actionType (id) {\n        return Object.assign(\n          Resource.factoryFor(ActionType, path).call(this, id),\n          {\n            read (...args) {\n              return readActionType.call(this, id, ...args)\n            }\n          }\n        )\n      }\n    }\n  }\n}\n\n/**\n * Normalize arguments and response on single read request.\n *\n * @param {String} id - Action type ID\n * @param {*} args - Arguments passed to .read method\n * @return {Promise}\n */\nfunction readActionType (id, ...args) {\n  if (!id) {\n    return Resource.prototype.read.call(this, ...args)\n  } else {\n    const normalizedArgs = normalizeArguments(id)(...args)\n    return new Promise((resolve, reject) => {\n      Resource.prototype.read.call(this, ...normalizedArgs)\n        .then(actionTypes => {\n          if (!actionTypes.length) {\n            // Fake 404\n            reject({\n              status: 404,\n              errors: ['The action type was not found.']\n            })\n          }\n          resolve(actionTypes[0])\n        })\n    })\n  }\n}\n\n/**\n * Curry normalizeArguments with action type id. Converts single resource path\n * (e.g. /actions/_custom) into plural with filter\n * (e.g. /actions?filter=name=_custom).\n *\n * @param {String} id - ID of action type\n * @return {Function} Normalize arguments transformer.\n */\nfunction normalizeArguments (id) {\n  return (...args) => {\n    let options\n    let firstArg = args[0]\n\n    if (isUndefined(firstArg) || isFunction(firstArg)) {\n      options = {}\n      args.unshift(options)\n    } else {\n      options = firstArg\n    }\n\n    options.url = path\n    options.params = Object.assign(\n      { filter: { name: decodeURIComponent(id) } },\n      options.params\n    )\n\n    return args\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport isString from 'lodash-es/isString'\n\nconst path = '/status'\n\nexport default class Status extends Entity {\n  static resourceFactory () {\n    return {\n      status () {\n        if (isString(arguments[0])) {\n          throw new TypeError('There is no single resource for Status')\n        }\n\n        return Resource.factoryFor(Status, path).call(this)\n      }\n    }\n  }\n}\n","import Entity from './Entity'\nimport Status from './Status'\nimport Resource from '../resource/Resource'\nimport { mixinResources } from '../util/mixin'\nimport isString from 'lodash-es/isString'\n\nconst path = '/reactor/script'\nconst ReactorScriptResources = mixinResources([\n  Status\n])\n\n/**\n * Represents a ReactorScript entity object.\n *\n * @extends Entity\n */\nexport default class ReactorScript extends ReactorScriptResources(Entity) {\n  static resourceFactory () {\n    return {\n      reactorScript () {\n        // Reactor scripts don't have single resource endpoint (e.g.: /scripts/:id)\n        if (isString(arguments[0])) {\n          throw new TypeError('There is no single resource for Reactor Scripts')\n        }\n\n        return Resource.factoryFor(ReactorScript, path, ReactorScriptResources)\n          .call(this)\n      }\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport symbols from '../symbols'\n\nconst path = '/reactor/schedules'\n\n/**\n * Represents a ReactorSchedule entity object.\n *\n * @extends Entity\n */\nexport default class ReactorSchedule extends Entity {\n  static resourceFactory () {\n    return {\n      reactorSchedule (id) {\n        const appPath = this instanceof Scope ? this[symbols.path] : ''\n\n        return Resource.factoryFor(ReactorSchedule, appPath + path)\n          .call(this, id)\n      }\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport symbols from '../symbols'\nimport isUndefined from 'lodash-es/isUndefined'\nimport isFunction from 'lodash-es/isFunction'\nimport isString from 'lodash-es/isString'\n\nconst path = '/reactor/logs'\n\n/**\n * Represents a ReactorLog entity object.\n *\n * @extends Entity\n */\nexport default class ReactorLog extends Entity {\n  static resourceFactory () {\n    return {\n      reactorLog (id) {\n        // Reactor logs don't have single resource endpoint (e.g.: /logs/:id)\n        if (isString(arguments[0])) {\n          throw new TypeError('There is no single resource for Reactor Logs')\n        }\n\n        const appPath = this instanceof Scope ? this[symbols.path] : ''\n\n        return Object.assign(\n          Resource.factoryFor(ReactorLog, appPath + path).call(this, id),\n          {\n            create (...args) {\n              return createLogs.call(this, ...args)\n            }\n          }\n        )\n      }\n    }\n  }\n}\n\n/**\n * Use bulk endpoint when creating array of logs.\n *\n * @param {Object} data - Log payload.\n * @param {Array} rest - Rest of arguments.\n * @return {Promise}\n */\nfunction createLogs (data, ...rest) {\n  if (Array.isArray(data)) {\n    let [options] = rest\n    if (isUndefined(options) || isFunction(options)) {\n      options = {}\n      rest.unshift(options)\n    }\n    options.url = `${this.path}/bulk`\n  }\n\n  return Resource.prototype.create.call(this, data, ...rest)\n}\n","import Entity from './Entity'\nimport ReactorScript from './ReactorScript'\nimport ReactorSchedule from './ReactorSchedule'\nimport ReactorLog from './ReactorLog'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport { mixinResources } from '../util/mixin'\n\nconst path = '/applications'\nconst ApplicationResources = mixinResources([\n  ReactorScript,\n  ReactorSchedule,\n  ReactorLog\n])\n\n/**\n * Represents an Application entity.\n *\n * @extends Entity\n */\nexport default class Application extends ApplicationResources(Entity) {\n  /**\n   * Return simple resource factory for Applications.\n   *\n   * @static\n   * @return {{application: Function}}\n   */\n  static resourceFactory () {\n    return {\n      application (id) {\n        // Only allowed on Entities and Resources.\n        if (this instanceof Scope) {\n          throw new Error('Application is not a top-level resource.')\n        }\n\n        return Resource.factoryFor(Application, path, ApplicationResources)\n          .call(this, id)\n      }\n    }\n  }\n}\n","import Entity from './Entity'\nimport Application from './Application'\nimport Resource from '../resource/Resource'\nimport { mixinResources } from '../util/mixin'\n\nconst path = '/projects'\nconst ProjectResources = mixinResources([\n  Application\n])\n\n/**\n * Represents a Project entity object.\n *\n * @extends Entity\n */\nexport default class Project extends ProjectResources(Entity) {\n  /**\n   * Return simple resource factory for Projects.\n   *\n   * @static\n   * @return {{project: Function}}\n   */\n  static resourceFactory () {\n    return {\n      project: Resource.factoryFor(Project, path, ProjectResources)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\nimport isString from 'lodash-es/isString'\n\nconst path = '/permissions'\n\n/**\n * Represents a Permission entity.\n *\n * @extends Entity\n */\nexport default class Permission extends Entity {\n  /**\n   * Return simple resource factory for Permissions.\n   *\n   * @static\n   * @return {{permission: Function}}\n   */\n  static resourceFactory () {\n    return {\n      permission () {\n        // Permissions don't have single resource endpoint (e.g.: /permissions/:id)\n        if (isString(arguments[0])) {\n          throw new TypeError('There is no single resource for Permissions')\n        }\n\n        // Only allowed on Entities and Resources.\n        if (this instanceof Scope) {\n          throw new Error('Permission is not a top-level resource.')\n        }\n\n        return Resource.factoryFor(Permission, path).call(this)\n      }\n    }\n  }\n}\n","import Entity from './Entity'\nimport Permission from './Permission'\nimport Resource from '../resource/Resource'\nimport { mixinResources } from '../util/mixin'\n\nconst path = '/roles'\nconst RoleResources = mixinResources([\n  Permission\n])\n\n/**\n * Represents a Role entity object.\n *\n * @extends Entity\n */\nexport default class Role extends RoleResources(Entity) {\n  /**\n   * Return simple resource factory for Roles.\n   *\n   * @static\n   * @return {{role: Function}}\n   */\n  static resourceFactory () {\n    return {\n      role: Resource.factoryFor(Role, path, RoleResources)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\n\nconst path = '/users'\n\n/**\n * Represents a User entity object.\n *\n * @extends Entity\n */\nexport default class User extends Entity {\n  /**\n   * Return simple resource factory for AppUsers.\n   *\n   * @static\n   * @return {{appUser: Function}}\n   */\n  static resourceFactory () {\n    return {\n      user: Resource.factoryFor(User, path)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport Scope from '../scope/Scope'\n\nconst path = '/tasks'\n\n/**\n * Represents a Task entity.\n *\n * @extends Entity\n */\nexport default class Task extends Entity {\n  /**\n   * Return simple resource factory for Tasks.\n   *\n   * @static\n   * @return {{task: Function}}\n   */\n  static resourceFactory () {\n    return {\n      task (id) {\n        // Only allowed on Entities and Resources.\n        if (this instanceof Scope) {\n          throw new Error('Permission is not a top-level resource.')\n        }\n\n        return Resource.factoryFor(Task, path).call(this, id)\n      }\n    }\n  }\n}\n","import Entity from './Entity'\nimport Task from './Task'\nimport Resource from '../resource/Resource'\nimport { mixinResources } from '../util/mixin'\n\nconst path = '/batches'\nconst BatchResources = mixinResources([\n  Task\n])\n\n/**\n * Represents a Batch entity object.\n *\n * @extends Entity\n */\nexport default class Batch extends BatchResources(Entity) {\n  /**\n   * Return simple resource factory for Batches.\n   *\n   * @static\n   * @return {{batch: Function}}\n   */\n  static resourceFactory () {\n    return {\n      batch: Resource.factoryFor(Batch, path, BatchResources)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\n\nconst path = '/places'\n\n/**\n * Represents a Place entity object.\n *\n * @extends Entity\n */\nexport default class Place extends Entity {\n  /**\n   * Return simple resource factory for Places.\n   *\n   * @static\n   * @return {{place: Function}}\n   */\n  static resourceFactory () {\n    return {\n      place: Resource.factoryFor(Place, path)\n    }\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\n\nconst path = '/files'\n\n/**\n * Represents a File entity object.\n *\n * @extends Entity\n */\nexport default class File extends Entity {\n  /**\n   * Return simple resource factory for Files.\n   *\n   * @static\n   * @return {{file: Function}}\n   */\n  static resourceFactory () {\n    // TODO enable Node.js File streams and multipart/form-data files/blobs\n\n    return {\n      file: Resource.factoryFor(File, path)\n    }\n  }\n}\n","import Scope from './Scope'\nimport Product from '../entity/Product'\nimport Thng from '../entity/Thng'\nimport Collection from '../entity/Collection'\nimport Action from '../entity/Action'\nimport ActionType from '../entity/ActionType'\nimport Project from '../entity/Project'\nimport Role from '../entity/Role'\nimport User from '../entity/User'\nimport Batch from '../entity/Batch'\nimport Place from '../entity/Place'\nimport File from '../entity/File'\nimport { mixinResources } from '../util/mixin'\nimport symbols from '../symbols'\n\n/**\n * Mixin with all the top-level Operator resources.\n *\n * @mixin\n */\nconst OperatorAccess = mixinResources([\n  Product,          // CRUD\n  Thng,             // CRUD\n  Collection,       // CRUD\n  Action,           // CR\n  ActionType,       // CRUD\n  Project,          // CRUD\n  Role,             // CRUD\n  User,             // R\n  Batch,            // CRUD\n  Place,            // CRUD\n  File              // CRUD\n])\n\n/**\n * Operator is the Scope with highest permissions that can manage the account\n * resources. Should be used with caution in server-side code.\n *\n * @extends Scope\n * @mixes OperatorAccess\n */\nexport default class Operator extends OperatorAccess(Scope) {\n  /**\n   * Creates an instance of Operator.\n   *\n   * @param {string} apiKey - API Key of scope\n   * @param {Object} [data={}] - Optional operator data\n   */\n  constructor (apiKey, data = {}) {\n    super(apiKey, data)\n\n    this[symbols.init] = this[symbols.init]\n      .then(access => {\n        this.id = access.actor.id\n        this[symbols.path] = this._getPath()\n      })\n      .then(this.read.bind(this))\n      .catch(() => {\n        throw new Error('There is no operator with this API Key')\n      })\n  }\n\n  // PRIVATE\n\n  /**\n   * Return operator endpoint.\n   *\n   * @return {string}\n   */\n  _getPath () {\n    return `/operators/${this.id}`\n  }\n}\n","import Scope from './Scope'\nimport Product from '../entity/Product'\nimport Thng from '../entity/Thng'\nimport Collection from '../entity/Collection'\nimport Action from '../entity/Action'\nimport ActionType from '../entity/ActionType'\nimport Role from '../entity/Role'\nimport Place from '../entity/Place'\nimport { mixinResources } from '../util/mixin'\nimport api from '../api'\nimport symbols from '../symbols'\n\n/**\n * Mixin with all the top-level User resources.\n *\n * @mixin\n */\nconst UserAccess = mixinResources([\n  Product,          // CRU\n  Thng,             // CRU\n  Collection,       // CRU\n  Action,           // CR\n  ActionType,       // R\n  Role,             // R\n  Place             // R\n])\n\n/**\n * User is the Scope that represents an application user. It is usually\n * retrieved by authenticating a user in an app, but can also be instantiated\n * explicitly if API Key and details are known (e.g. stored in localStorage).\n *\n * @extends Scope\n * @mixes UserAccess\n */\nexport default class User extends UserAccess(Scope) {\n  /**\n   * Creates an instance of User.\n   *\n   * @param {string} apiKey - API Key of scope\n   * @param {Object} [data={}] - Optional user data\n   */\n  constructor (apiKey, data = {}) {\n    super(apiKey, data)\n\n    this[symbols.init] = this[symbols.init]\n      .then(access => {\n        this.id = access.actor.id\n        this[symbols.path] = this._getPath()\n      })\n      .then(this.read.bind(this))\n      .catch(() => {\n        throw new Error('There is no user with this API Key')\n      })\n  }\n\n  /**\n   * Log current user out of EVRYTHNG platform. I.e. API Key is not longer\n   * valid.\n   *\n   * @param {Function} callback - Error first callback\n   * @returns {Promise.<void>}\n   */\n  async logout (callback) {\n    try {\n      await this._invalidateUser()\n      if (callback) callback(null)\n    } catch (err) {\n      if (callback) callback(err)\n      throw err\n    }\n  }\n\n  // PRIVATE\n\n  /**\n   * Return user endpoint.\n   *\n   * @return {string}\n   */\n  _getPath () {\n    return `/users/${this.id}`\n  }\n\n  /**\n   * Request to invalidate API Key.\n   *\n   * @returns {Promise}\n   * @private\n   */\n  _invalidateUser () {\n    return api({\n      url: '/auth/all/logout',\n      method: 'post',\n      apiKey: this.apiKey\n    })\n  }\n}\n","import Entity from './Entity'\nimport Resource from '../resource/Resource'\nimport api from '../api'\nimport symbols from '../symbols'\nimport isString from 'lodash-es/isString'\n\nconst path = '/auth/evrythng/users'\n\n/**\n * Represents an AppUser access entry object. In the API there is a distinction\n * and different actions available for AppUser access. I.e. they can be validated.\n *\n * @extends Entity\n */\nexport default class UserAccess extends Entity {\n  /**\n   * Return resource factory for AppUsers access.\n   *\n   * @static\n   * @return {{appUser: Function}}\n   */\n  static resourceFactory () {\n    return {\n      userAccess (id) {\n        return Object.assign(\n          Resource.factoryFor(UserAccess, path).call(this, id),\n          {\n            create (...args) {\n              return createAppUser.call(this, ...args)\n            },\n            validate (...args) {\n              return validate.call(this, ...args)\n            }\n          }\n        )\n      }\n    }\n  }\n\n  /**\n   * Convert evrythngUser id into standard ID field.\n   *\n   * @param {Resource} resource - Resource owner of this entity.\n   * @param {Object} [body] Optional entity data\n   */\n  constructor (resource, body = {}) {\n    const copy = Object.assign({}, body)\n    if (copy.evrythngUser) {\n      copy.id = copy.evrythngUser\n      Reflect.deleteProperty(copy, 'evrythngUser')\n    }\n    super(resource, copy)\n  }\n\n  /**\n   * Validate user access using own activation code.\n   *\n   * @return {Promise}\n   */\n  validate () {\n    return validate.call(this, this.activationCode)\n  }\n}\n\n/**\n * Create anonymous app user if anonymous property defined.\n *\n * @param {Array} args - Arguments array.\n * @return {Promise}\n */\nfunction createAppUser (...args) {\n  const [data] = args\n  if (data && data.anonymous) {\n    return createAnonymousUser.call(this, ...args)\n  } else {\n    return Resource.prototype.create.call(this, ...args)\n  }\n}\n\n/**\n * Send a request to the validate endpoint with the given activation code.\n *\n * @param {String} activationCode - Activation code provided on creation.\n * @return {Promise}\n */\nfunction validate (activationCode) {\n  if (!activationCode || !isString(activationCode)) {\n    throw new Error('Activation code must be a string.')\n  }\n\n  if (this.type === 'anonymous') {\n    throw new Error(\"Anonymous users can't be validated.\")\n  }\n\n  let scope = this.scope\n  let path = this.path\n\n  // If called from the entity, the scope is the resource's scope.\n  if (this instanceof Entity) {\n    scope = this[symbols.resource].scope\n    path = `${this[symbols.resource].path}/${this.id}`\n  }\n\n  // Activate  user.\n  return api({\n    url: `${path}/validate`,\n    method: 'post',\n    apiKey: scope.apiKey,\n    data: { activationCode }\n  })\n}\n\n/**\n * Create anonymous user in API and return new scope for that user.\n *\n * @return {Promise}\n */\nfunction createAnonymousUser () {\n  return api({\n    url: this.path,\n    method: 'post',\n    params: {\n      anonymous: true // must be set to create anonymous user\n    },\n    data: {},\n    apiKey: this.scope.apiKey\n  })\n    .then(createUserScope.bind(this))\n}\n\n// TODO Create User Scope\nfunction createUserScope (access) {\n  // return new User({\n  //   id: access.evrythngUser,\n  //   apiKey: access.evrythngApiKey,\n  //   type: 'anonymous'\n  // })\n}\n","import Scope from './Scope'\nimport User from './User'\nimport Product from '../entity/Product'\nimport Action from '../entity/Action'\nimport Place from '../entity/Place'\nimport UserAccess from '../entity/UserAccess'\nimport { mixinResources } from '../util/mixin'\nimport api from '../api'\nimport symbols from '../symbols'\nimport isPlainObject from 'lodash-es/isPlainObject'\n\n/**\n * E-mail and password used to create a user into the platform.\n *\n * @typedef {Object} AccessCredentials\n * @param {string} email - E-mail used on registration\n * @param {string} password - Password defined on registration\n */\n\n/**\n * Mixin with all the top-level Application resources.\n *\n * @mixin\n */\nconst ApplicationAccess = mixinResources([\n  Product,          // R\n  Action,           // C scans\n  UserAccess,       // C\n  Place             // R\n])\n\n/**\n * Application is the Scope with the least permissions. It is meant to be used\n * to create and authenticate application users.\n *\n * @extends Scope\n * @mixes ApplicationAccess\n */\nexport default class Application extends ApplicationAccess(Scope) {\n  /**\n   * Creates an instance of Application.\n   *\n   * @param {string} apiKey - API Key of scope\n   * @param {Object} [data={}] - Optional application data\n   */\n  constructor (apiKey, data = {}) {\n    super(apiKey, data)\n\n    this[symbols.init] = this[symbols.init]\n      .then(access => {\n        this.id = access.actor.id\n        this.project = access.project\n        this[symbols.path] = this._getPath()\n      })\n      .then(this.read.bind(this))\n      .catch(() => {\n        throw new Error('There is no application with this API Key')\n      })\n  }\n\n  /**\n   * Login user using EVRYTHNG credentials and create User scope on success.\n   *\n   * @param {AccessCredentials} credentials - User login credentials\n   * @param {Function} callback - Error first callback\n   * @returns {Promise.<User>} - Authorized User scope\n   */\n  async login (credentials, callback) {\n    try {\n      const user = await this._authenticateUser(credentials)\n      const userScope = new User(user.access.apiKey, user)\n      if (callback) callback(null, userScope)\n      return userScope\n    } catch (err) {\n      if (callback) callback(err)\n      throw err\n    }\n  }\n\n  // PRIVATE\n\n  /**\n   * Return application endpoint, nested within projects.\n   *\n   * @returns {string}\n   * @private\n   */\n  _getPath () {\n    return `/projects/${this.project}/applications/${this.id}`\n  }\n\n  /**\n   * Validate user credentials.\n   *\n   * @param {AccessCredentials} credentials - User login credentials\n   * @returns {Promise.<Object>} - User details with access\n   * @private\n   */\n  _authenticateUser (credentials) {\n    if (!credentials || !isPlainObject(credentials)) {\n      throw new TypeError('Credentials are missing.')\n    }\n\n    return api({\n      url: '/users/login',\n      method: 'post',\n      data: credentials,\n      apiKey: this.apiKey\n    })\n  }\n}\n","import Application from './Application'\nimport Thng from '../entity/Thng'\nimport Collection from '../entity/Collection'\nimport ActionType from '../entity/ActionType'\nimport User from '../entity/User'\nimport ReactorSchedule from '../entity/ReactorSchedule'\nimport ReactorLog from '../entity/ReactorLog'\nimport { mixinResources } from '../util/mixin'\nimport api from '../api'\nimport symbols from '../symbols'\nimport isPlainObject from 'lodash-es/isPlainObject'\n\n/**\n * E-mail and password used to create a user into the platform.\n *\n * @typedef {Object} AccessCredentials\n * @param {string} email - E-mail used on registration\n * @param {string} password - Password defined on registration\n */\n\n/**\n * Mixin with all the top-level Application resources.\n *\n * @mixin\n */\nconst ApplicationAccess = mixinResources([\n  Thng,             // CRUD\n  Collection,       // CRUD\n  ActionType,       // CR\n  User,             // R\n  ReactorSchedule,  // C\n  ReactorLog        // C\n\n  // From Application:\n  // Product        // CRUD\n  // Place          // CRUD\n  // Action         // CR\n])\n\n/**\n * Application is the Scope with the least permissions. It is meant to be used\n * to create and authenticate application users.\n *\n * @extends Scope\n * @mixes ApplicationAccess\n */\nexport default class TrustedApplication extends ApplicationAccess(Application) {\n  /**\n   * Creates an instance of Application.\n   *\n   * @param {string} apiKey - API Key of scope\n   * @param {Object} [data={}] - Optional application data\n   */\n  constructor (apiKey, data = {}) {\n    super(apiKey, data)\n\n    this[symbols.init] = this[symbols.init]\n      .then(access => {\n        this.id = access.actor.id\n        this.project = access.project\n        this[symbols.path] = this._getPath()\n      })\n      .then(this.read.bind(this))\n      .catch(() => {\n        throw new Error('There is no application with this API Key')\n      })\n  }\n\n  /**\n   * Login user using EVRYTHNG credentials and create User scope on success.\n   *\n   * @param {AccessCredentials} credentials - User login credentials\n   * @param {Function} callback - Error first callback\n   * @returns {Promise.<User>} - Authorized User scope\n   */\n  async login (credentials, callback) {\n    try {\n      const user = await this._authenticateUser(credentials)\n      const userScope = new User(user.access.apiKey, user)\n      if (callback) callback(null, userScope)\n      return userScope\n    } catch (err) {\n      if (callback) callback(err)\n      throw err\n    }\n  }\n\n  // PRIVATE\n\n  /**\n   * Return application endpoint, nested within projects.\n   *\n   * @returns {string}\n   * @private\n   */\n  _getPath () {\n    return `/projects/${this.project}/applications/${this.id}`\n  }\n\n  /**\n   * Validate user credentials.\n   *\n   * @param {AccessCredentials} credentials - User login credentials\n   * @returns {Promise.<Object>} - User details with access\n   * @private\n   */\n  _authenticateUser (credentials) {\n    if (!credentials || !isPlainObject(credentials)) {\n      throw new TypeError('Credentials are missing.')\n    }\n\n    return api({\n      url: '/users/login',\n      method: 'post',\n      data: credentials,\n      apiKey: this.apiKey\n    })\n  }\n}\n","import Scope from './Scope'\nimport Property from '../entity/Property'\nimport Action from '../entity/Action'\n// import Location from '../entity/Location'\nimport symbols from '../symbols'\nimport { mixinResources } from '../util/mixin'\n\n/**\n * Mixin with all the top-level Application resources.\n *\n * @mixin\n */\nconst DeviceAccess = mixinResources([\n  Property,          // CRUD\n  Action             // CRUD\n  // Location           // CRUD\n])\n\n/**\n * Device is the Scope that represents an active/smart Thng. It can only\n * essentially update itself and its nested resources (e.g. Property, Location,\n * Action).\n *\n * @extends Scope\n */\nexport default class Device extends DeviceAccess(Scope) {\n  /**\n   * Creates an instance of Device.\n   *\n   * @param {string} apiKey - API Key of scope\n   * @param {Object} [data={}] - Optional device data\n   */\n  constructor (apiKey, data = {}) {\n    super(apiKey, data)\n\n    this[symbols.init] = this[symbols.init]\n      .catch(() => {\n        throw new Error('There is no thng with this API Key')\n      })\n      .then(access => {\n        this.id = access.actor.id\n        this[symbols.path] = this._getPath()\n      })\n      .then(this.read.bind(this))\n  }\n\n  // PRIVATE\n\n  /**\n   * Return device thng endpoint.\n   *\n   * @return {string}\n   */\n  _getPath () {\n    return `/thngs/${this.id}`\n  }\n}\n","import Product from './entity/Product'\nimport Thng from './entity/Thng'\nimport Collection from './entity/Collection'\nimport Property from './entity/Property'\nimport Action from './entity/Action'\nimport ActionType from './entity/ActionType'\nimport Application from './entity/Application'\nimport User from './entity/User'\nimport Batch from './entity/Batch'\nimport Location from './entity/Location'\nimport Permission from './entity/Permission'\nimport Project from './entity/Project'\nimport Role from './entity/Role'\nimport Task from './entity/Task'\n\nexport default {\n  Product,\n  Thng,\n  Collection,\n  Property,\n  Action,\n  ActionType,\n  Application,\n  User,\n  Batch,\n  Location,\n  Permission,\n  Project,\n  Role,\n  Task\n}\n","export const version = '5.0.0'\n\n// Globals\nexport { default as settings } from './settings'\nexport { default as setup } from './setup'\nexport { default as api } from './api'\n\n// TODO add method to install plugins\n\n// Scopes\nexport { default as Operator } from './scope/Operator'\nexport { default as Application } from './scope/Application'\nexport { default as TrustedApplication } from './scope/TrustedApplication'\nexport { default as User } from './scope/User'\nexport { default as Device } from './scope/Device'\n\n// Namespaces for: Entities and Symbols\nexport { default as Entity } from './entities'\nexport { default as Symbol } from './symbols'\n\n// Extensible internal modules\nexport { default as _Resource } from './resource/Resource'\nexport { default as _Entity } from './entity/Entity'\nexport { default as _Scope } from './scope/Scope'\n"],"names":["defaultSettings","settings","Object","assign","Symbol","objectProto","hasOwnProperty","symToStringTag","nativeObjectToString","setup","customSettings","isPlainObject","TypeError","SPECIALS","SPECIALS_REGEXP","RegExp","join","SPECIALS_ESCAPE","buildParams","params","useEncoding","entries","map","buildParam","encode","uriEncoder","key","value","encodeURIComponent","escapeSpecials","replace","buildUrl","options","url","apiUrl","api","customOptions","callback","initialOptions","mergeInitialOptions","applyRequestInterceptors","then","makeFetch","handleResponse","applyResponseInterceptors","success","catch","failure","method","headers","authorization","apiKey","data","body","JSON","stringify","deleteProperty","cancelled","cancel","intercepted","Promise","resolve","Array","isArray","interceptors","filter","isFunction","interceptor","request","forEach","prevOptions","reject","finalOptions","req","fetch","timeout","race","res","fullResponse","response","status","json","ok","err","Scope","isString","Error","symbols","init","opts","path","_request","global","this","require$$0","parseLinkHeader","header","links","length","parts","split","i","section","trim","name","Resource","type","MixinNestedResources","id","parentPath","parentScope","newPath","scope","Entity","resource","XResource","prototype","entity","deserialize","bind","indexOf","newResource","EntityType","_linkRequest","result","next","requestOptions","userOptions","serialize","deserialized","get","linkHeader","decodeURIComponent","reduce","ret","k","v","update","updated","delete","Property","thngPath","factoryFor","call","create","normalizeArguments","val","rest","getCurrentPosition","window","navigator","geolocation","geolocationOptions","message","Action","actionType","typePath","context","args","createAction","caller","fillAction","action","baseCreate","updatedArgs","useGeolocation","fillActionLocation","position","info","firstArg","isUndefined","unshift","entityIdentifier","getIdentifier","constructor","toLocaleLowerCase","location","coords","latitude","longitude","locationSource","mixinResources","entities","resourceFactories","e","resourceFactory","accessResources","mixin","Superclass","behaviour","proto","target","Reflect","ownKeys","property","defineProperty","ProductResources","Product","Location","arguments","updateLocation","baseUpdate","fillLocation","ThngResources","Thng","CollectionResources","Collection","ActionType","readActionType","read","normalizedArgs","actionTypes","Status","ReactorScriptResources","ReactorScript","ReactorSchedule","appPath","ReactorLog","createLogs","ApplicationResources","Application","ProjectResources","Project","Permission","RoleResources","Role","User","Task","BatchResources","Batch","Place","File","OperatorAccess","Operator","access","actor","_getPath","UserAccess","_invalidateUser","createAppUser","validate","copy","evrythngUser","activationCode","anonymous","createAnonymousUser","createUserScope","ApplicationAccess","project","credentials","_authenticateUser","user","userScope","TrustedApplication","DeviceAccess","Device","version"],"mappings":";;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA,IAAMA,kBAAkB;UACd,0BADc;UAEd,EAFc;gBAGR,KAHQ;eAIT,IAJS;WAKb,CALa;WAMb;oBACS;GAPI;gBASR;;;CAThB,CAaA,IAAMC,WAAWC,OAAOC,MAAP,CAAc,EAAd,EAAkBH,eAAlB,CAAjB;;AC5CA;AACA,IAAI,UAAU,GAAG,OAAO,MAAM,IAAI,QAAQ,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,KAAK,MAAM,IAAI,MAAM;;ACC1F;AACA,IAAI,QAAQ,GAAG,OAAO,IAAI,IAAI,QAAQ,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,IAAI,IAAI,CAAC;;;AAGjF,IAAI,IAAI,GAAG,UAAU,IAAI,QAAQ,IAAI,QAAQ,CAAC,aAAa,CAAC,EAAE;;ACJ9D;AACA,IAAII,QAAM,GAAG,IAAI,CAAC,MAAM;;ACDxB;AACA,IAAIC,aAAW,GAAG,MAAM,CAAC,SAAS,CAAC;;;AAGnC,IAAIC,gBAAc,GAAGD,aAAW,CAAC,cAAc,CAAC;;;;;;;AAOhD,IAAI,oBAAoB,GAAGA,aAAW,CAAC,QAAQ,CAAC;;;AAGhD,IAAIE,gBAAc,GAAGH,QAAM,GAAGA,QAAM,CAAC,WAAW,GAAG,SAAS,CAAC;;;;;;;;;AAS7D,SAAS,SAAS,CAAC,KAAK,EAAE;EACxB,IAAI,KAAK,GAAGE,gBAAc,CAAC,IAAI,CAAC,KAAK,EAAEC,gBAAc,CAAC;MAClD,GAAG,GAAG,KAAK,CAACA,gBAAc,CAAC,CAAC;;EAEhC,IAAI;IACF,KAAK,CAACA,gBAAc,CAAC,GAAG,SAAS,CAAC;IAClC,IAAI,QAAQ,GAAG,IAAI,CAAC;GACrB,CAAC,OAAO,CAAC,EAAE,EAAE;;EAEd,IAAI,MAAM,GAAG,oBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;EAC9C,IAAI,QAAQ,EAAE;IACZ,IAAI,KAAK,EAAE;MACT,KAAK,CAACA,gBAAc,CAAC,GAAG,GAAG,CAAC;KAC7B,MAAM;MACL,OAAO,KAAK,CAACA,gBAAc,CAAC,CAAC;KAC9B;GACF;EACD,OAAO,MAAM,CAAC;CACf;;AC3CD;AACA,IAAIF,aAAW,GAAG,MAAM,CAAC,SAAS,CAAC;;;;;;;AAOnC,IAAIG,sBAAoB,GAAGH,aAAW,CAAC,QAAQ,CAAC;;;;;;;;;AAShD,SAAS,cAAc,CAAC,KAAK,EAAE;EAC7B,OAAOG,sBAAoB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;CACzC;;ACfD;AACA,IAAI,OAAO,GAAG,eAAe;IACzB,YAAY,GAAG,oBAAoB,CAAC;;;AAGxC,IAAI,cAAc,GAAGJ,QAAM,GAAGA,QAAM,CAAC,WAAW,GAAG,SAAS,CAAC;;;;;;;;;AAS7D,SAAS,UAAU,CAAC,KAAK,EAAE;EACzB,IAAI,KAAK,IAAI,IAAI,EAAE;IACjB,OAAO,KAAK,KAAK,SAAS,GAAG,YAAY,GAAG,OAAO,CAAC;GACrD;EACD,OAAO,CAAC,cAAc,IAAI,cAAc,IAAI,MAAM,CAAC,KAAK,CAAC;MACrD,SAAS,CAAC,KAAK,CAAC;MAChB,cAAc,CAAC,KAAK,CAAC,CAAC;CAC3B;;ACzBD;;;;;;;;AAQA,SAAS,OAAO,CAAC,IAAI,EAAE,SAAS,EAAE;EAChC,OAAO,SAAS,GAAG,EAAE;IACnB,OAAO,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;GAC7B,CAAC;CACH;;ACVD;AACA,IAAI,YAAY,GAAG,OAAO,CAAC,MAAM,CAAC,cAAc,EAAE,MAAM,CAAC;;ACHzD;;;;;;;;;;;;;;;;;;;;;;;;AAwBA,SAAS,YAAY,CAAC,KAAK,EAAE;EAC3B,OAAO,KAAK,IAAI,IAAI,IAAI,OAAO,KAAK,IAAI,QAAQ,CAAC;CAClD;;ACtBD;AACA,IAAI,SAAS,GAAG,iBAAiB,CAAC;;;AAGlC,IAAI,SAAS,GAAG,QAAQ,CAAC,SAAS;IAC9B,WAAW,GAAG,MAAM,CAAC,SAAS,CAAC;;;AAGnC,IAAI,YAAY,GAAG,SAAS,CAAC,QAAQ,CAAC;;;AAGtC,IAAI,cAAc,GAAG,WAAW,CAAC,cAAc,CAAC;;;AAGhD,IAAI,gBAAgB,GAAG,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BjD,SAAS,aAAa,CAAC,KAAK,EAAE;EAC5B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC,IAAI,SAAS,EAAE;IAC1D,OAAO,KAAK,CAAC;GACd;EACD,IAAI,KAAK,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;EAChC,IAAI,KAAK,KAAK,IAAI,EAAE;IAClB,OAAO,IAAI,CAAC;GACb;EACD,IAAI,IAAI,GAAG,cAAc,CAAC,IAAI,CAAC,KAAK,EAAE,aAAa,CAAC,IAAI,KAAK,CAAC,WAAW,CAAC;EAC1E,OAAO,OAAO,IAAI,IAAI,UAAU,IAAI,IAAI,YAAY,IAAI;IACtD,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,gBAAgB,CAAC;CAC/C;;ACxDD;;;;;;AAMA,AAAe,SAASK,KAAT,CAAgBC,cAAhB,EAAgC;MACzC,CAACC,cAAcD,cAAd,CAAL,EAAoC;UAC5B,IAAIE,SAAJ,CAAc,gDAAd,CAAN;;;;SAIKV,OAAOC,MAAP,CAAcF,QAAd,EAAwBS,cAAxB,CAAP;;;ACfF;;;;;;;;;;;;;;;;;;;;;;;;;AAyBA,SAAS,QAAQ,CAAC,KAAK,EAAE;EACvB,IAAI,IAAI,GAAG,OAAO,KAAK,CAAC;EACxB,OAAO,KAAK,IAAI,IAAI,KAAK,IAAI,IAAI,QAAQ,IAAI,IAAI,IAAI,UAAU,CAAC,CAAC;CAClE;;ACzBD;AACA,IAAI,QAAQ,GAAG,wBAAwB;IACnC,OAAO,GAAG,mBAAmB;IAC7B,MAAM,GAAG,4BAA4B;IACrC,QAAQ,GAAG,gBAAgB,CAAC;;;;;;;;;;;;;;;;;;;AAmBhC,SAAS,UAAU,CAAC,KAAK,EAAE;EACzB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;IACpB,OAAO,KAAK,CAAC;GACd;;;EAGD,IAAI,GAAG,GAAG,UAAU,CAAC,KAAK,CAAC,CAAC;EAC5B,OAAO,GAAG,IAAI,OAAO,IAAI,GAAG,IAAI,MAAM,IAAI,GAAG,IAAI,QAAQ,IAAI,GAAG,IAAI,QAAQ,CAAC;CAC9E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCD,IAAMG,WAAW,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,EAAyC,GAAzC,EAA8C,GAA9C,CAAjB;AACA,IAAMC,kBAAkB,IAAIC,MAAJ,OAAeF,SAASG,IAAT,CAAc,IAAd,CAAf,QAAuC,GAAvC,CAAxB;AACA,IAAMC,kBAAkB,MAAxB;;;;;;;;;;AAUA,AAAe,SAASC,WAAT,GAAuD;MAAjCC,MAAiC,uEAAxB,EAAwB;MAApBC,WAAoB,uEAAN,IAAM;;SAC7DT,cAAcQ,MAAd,IACHjB,OAAOmB,OAAP,CAAeF,MAAf,EAAuBG,GAAvB,CAA2BC,WAAWH,WAAX,CAA3B,EAAoDJ,IAApD,CAAyD,GAAzD,CADG,GAEHG,MAFJ;;;;;;;;;;AAYF,SAASI,UAAT,CAAqBH,WAArB,EAAkC;MAC1BI,SAASC,WAAWL,WAAX,CAAf;SACO,gBAAkB;;QAAhBM,GAAgB;QAAXC,KAAW;;WACbH,OAAOE,GAAP,CAAV,SAAyBF,OAAON,YAAYS,KAAZ,CAAP,CAAzB;GADF;;;;;;;;;AAWF,SAASF,UAAT,CAAqBL,WAArB,EAAkC;SACzB,UAACO,KAAD;WAAWP,cACdQ,mBAAmBD,KAAnB,CADc,GAEdE,eAAeF,KAAf,CAFG;GAAP;;;;;;;;;AAWF,SAASE,cAAT,CAAyBF,KAAzB,EAAgC;SACvBA,MAAMG,OAAN,CAAchB,eAAd,EAA+BG,eAA/B,CAAP;;;ACnDF;;;;;;;AAOA,AAAe,SAASc,QAAT,CAAmBC,OAAnB,EAA4B;MACrCC,WAASD,QAAQE,MAAjB,GAA0BF,QAAQC,GAAtC;;MAEID,QAAQb,MAAZ,EAAoB;iBACPD,YAAYc,QAAQb,MAApB,CAAX;;;SAGKc,GAAP;;;ACZF;;;;;;;;;;;;AAYA,AAAe,SAASE,GAAT,GAA4C;MAA9BC,aAA8B,uEAAd,EAAc;MAAVC,QAAU;;MACrDC,iBAAiBC,oBAAoBH,aAApB,CAArB;;SAEOI,yBAAyBF,cAAzB,EACJG,IADI,CACC,mBAAW;WACRC,UAAUV,OAAV,EACJS,IADI,CACCE,eAAeX,OAAf,CADD,EAEJS,IAFI,CAECG,0BAA0BZ,OAA1B,CAFD,CAAP;GAFG,EAMJS,IANI,CAMCI,QAAQR,QAAR,CAND,EAOJS,KAPI,CAOEC,QAAQV,QAAR,CAPF,CAAP;;;;;;;;;;AAiBF,SAASE,mBAAT,CAA8BH,aAA9B,EAA6C;MACrCJ,UAAU9B,OAAOC,MAAP,CACd,EAAE6C,QAAQ,KAAV,EAAiBf,KAAK,EAAtB,EADc,EAEdhC,QAFc,EAGdmC,aAHc,EAId,EAAEa,SAAS/C,OAAOC,MAAP,CAAc,EAAd,EAAkBF,SAASgD,OAA3B,EAAoCb,cAAca,OAAlD,CAAX,EAJc,CAAhB;;;MAQI,CAACjB,QAAQiB,OAAR,CAAgBC,aAAjB,IAAkClB,QAAQmB,MAA9C,EAAsD;YAC5CF,OAAR,CAAgBC,aAAhB,GAAgClB,QAAQmB,MAAxC;;;;MAIEnB,QAAQoB,IAAZ,EAAkB;YACRC,IAAR,GAAeC,KAAKC,SAAL,CAAevB,QAAQoB,IAAvB,CAAf;YACQI,cAAR,CAAuBxB,OAAvB,EAAgC,MAAhC;;;SAGKA,OAAP;;;;;;;;;AASF,SAASQ,wBAAT,CAAmCR,OAAnC,EAA4C;;MAEtCyB,YAAY,KAAhB;WACSC,MAAT,GAAmB;gBACL,IAAZ;;;MAGEC,cAAcC,QAAQC,OAAR,CAAgB7B,OAAhB,CAAlB;;MAEI8B,MAAMC,OAAN,CAAc/B,QAAQgC,YAAtB,CAAJ,EAAyC;YAC/BA,YAAR,CACGC,MADH,CACU;aAAeC,WAAWC,YAAYC,OAAvB,CAAf;KADV,EAEGC,OAFH,CAEW,uBAAe;;oBAERV,YAAYlB,IAAZ,CAAiB,uBAAe;YACxCgB,SAAJ,EAAe,OAAOa,WAAP;eACRH,YAAYC,OAAZ,CAAoBE,WAApB,EAAiCZ,MAAjC,KAA4CY,WAAnD;OAFY,CAAd;KAJJ;;;SAWKX,YAAYlB,IAAZ,CAAiB,wBAAgB;;QAElCgB,SAAJ,EAAe;aACNG,QAAQW,MAAR,CAAe;gBACZ,CAAC,2CAAD,CADY;mBAET;OAFN,CAAP;;WAKKC,YAAP;GARK,CAAP;;;;;;;;;;;;AAqBF,SAAS9B,SAAT,CAAoBV,OAApB,EAA6B;MACrByC,MAAMC,MAAM3C,SAASC,OAAT,CAAN,EAAyBA,OAAzB,CAAZ;MACI,CAACA,QAAQ2C,OAAb,EAAsB;WACbF,GAAP;GADF,MAEO;WACEb,QAAQgB,IAAR,CAAa,CAClBH,GADkB,EAElB,IAAIb,OAAJ,CAAY,UAAUC,OAAV,EAAmBU,MAAnB,EAA2B;iBAC1B;eAAMA,OAAO,iBAAP,CAAN;OAAX,EAA4CvC,QAAQ2C,OAApD;KADF,CAFkB,CAAb,CAAP;;;;;;;;;;;;;AAkBJ,SAAShC,cAAT,CAAyBX,OAAzB,EAAkC;SACzB,oBAAY;QACX6C,MAAM7C,QAAQ8C,YAAR,GACRlB,QAAQC,OAAR,CAAgBkB,QAAhB,CADQ,GAERA,SAASC,MAAT,KAAoB,GAApB,GACApB,QAAQC,OAAR,EADA,GAEAkB,SAASE,IAAT,EAJJ;;WAMOJ,IAAIpC,IAAJ,CAAS,gBAAQ;UAClBsC,SAASG,EAAb,EAAiB;eACR9B,IAAP;OADF,MAEO;cACCA,IAAN;;KAJG,CAAP;GAPF;;;;;;;;;;;;AA0BF,SAASR,yBAAT,CAAoCZ,OAApC,EAA6C;SACpC,oBAAY;QACb2B,cAAcC,QAAQC,OAAR,CAAgBkB,QAAhB,CAAlB;;QAEIjB,MAAMC,OAAN,CAAc/B,QAAQgC,YAAtB,CAAJ,EAAyC;cAC/BA,YAAR,CACGC,MADH,CACU;eAAeC,WAAWC,YAAYY,QAAvB,CAAf;OADV,EAEGV,OAFH,CAEW,uBAAe;;sBAERV,YAAYlB,IAAZ,CAAiB0B,YAAYY,QAA7B,CAAd;OAJJ;;;WAQKpB,WAAP;GAZF;;;;;;;;;AAsBF,AAAO,SAASd,OAAT,CAAkBR,QAAlB,EAA4B;SAC1B,oBAAY;QACbA,QAAJ,EAAcA,SAAS,IAAT,EAAe0C,QAAf;WACPA,QAAP;GAFF;;;;;;;;;AAYF,AAAO,SAAShC,OAAT,CAAkBV,QAAlB,EAA4B;SAC1B,eAAO;QACRA,QAAJ,EAAcA,SAAS8C,GAAT;UACRA,GAAN;GAFF;;;ACjMF;;;;;;;;;;;;;;;;;;;;;;;AAuBA,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO;;ACnB3B;AACA,IAAI,SAAS,GAAG,iBAAiB,CAAC;;;;;;;;;;;;;;;;;;;AAmBlC,SAAS,QAAQ,CAAC,KAAK,EAAE;EACvB,OAAO,OAAO,KAAK,IAAI,QAAQ;KAC5B,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,YAAY,CAAC,KAAK,CAAC,IAAI,UAAU,CAAC,KAAK,CAAC,IAAI,SAAS,CAAC,CAAC;CAC9E;;AC3BD,cAAe;QACP/E,OAAO,MAAP,CADO;QAEPA,OAAO,MAAP,CAFO;YAGHA,OAAO,UAAP;CAHZ;;ACIA;;;;;;IAKqBgF;;;;;;;iBAONjC,MAAb,EAAgC;QAAXE,IAAW,uEAAJ,EAAI;;;QAC1B,CAACgC,SAASlC,MAAT,CAAL,EAAuB;YACf,IAAImC,KAAJ,CAAU,oDAAV,CAAN;;;SAGGnC,MAAL,GAAcA,MAAd;;;;SAIKoC,QAAQC,IAAb,IAAqBrD,IAAI;WAClB,SADkB;cAEf,KAAKgB;KAFM,CAArB;;;WAMOhD,MAAP,CAAc,IAAd,EAAoBkD,IAApB;;;;;;;;;;;;;2BASkB;UAAdrB,OAAc,uEAAJ,EAAI;;UACZyD,OAAOvF,OAAOC,MAAP,CAAc6B,OAAd,EAAuB;gBAC1B,KAD0B;aAE7B,KAAKuD,QAAQG,IAAb,CAF6B;gBAG1B,KAAKvC;OAHF,CAAb;;aAMO,KAAKwC,QAAL,CAAcF,IAAd,CAAP;;;;;;;;;;;;;2BAUMrC,MAAoB;UAAdpB,OAAc,uEAAJ,EAAI;;UACpByD,OAAOvF,OAAOC,MAAP,CAAc6B,OAAd,EAAuB;gBAC1B,KAD0B;aAE7B,KAAKuD,QAAQG,IAAb,CAF6B;gBAG1B,KAAKvC,MAHqB;;OAAvB,CAAb;;aAOO,KAAKwC,QAAL,CAAcF,IAAd,CAAP;;;;;;;;;;;;;;6BAWQzD,SAAS;;;aACVG,IAAIH,OAAJ,EAAaS,IAAb,CAAkB;eAAQvC,OAAOC,MAAP,QAAoBiD,IAApB,CAAR;OAAlB,CAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnEJ,CAAC,CAAC,SAAS,MAAM,EAAE;EACjB,YAAY,CAAC;;EAEb,IAAI,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC;EAC1B,IAAI,MAAM,GAAG,EAAE,CAAC,cAAc,CAAC;EAC/B,IAAI,SAAS,CAAC;EACd,IAAI,OAAO,GAAG,OAAO,MAAM,KAAK,UAAU,GAAG,MAAM,GAAG,EAAE,CAAC;EACzD,IAAI,cAAc,GAAG,OAAO,CAAC,QAAQ,IAAI,YAAY,CAAC;EACtD,IAAI,mBAAmB,GAAG,OAAO,CAAC,aAAa,IAAI,iBAAiB,CAAC;EACrE,IAAI,iBAAiB,GAAG,OAAO,CAAC,WAAW,IAAI,eAAe,CAAC;;EAE/D,IAAI,QAAQ,GAAG,OAAO,MAAM,KAAK,QAAQ,CAAC;EAC1C,IAAI,OAAO,GAAG,MAAM,CAAC,kBAAkB,CAAC;EACxC,IAAI,OAAO,EAAE;IACX,IAAI,QAAQ,EAAE;;;MAGZ,cAAc,GAAG,OAAO,CAAC;KAC1B;;;IAGD,OAAO;GACR;;;;EAID,OAAO,GAAG,MAAM,CAAC,kBAAkB,GAAG,QAAQ,GAAG,MAAM,CAAC,OAAO,GAAG,EAAE,CAAC;;EAErE,SAAS,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE;;IAEjD,IAAI,cAAc,GAAG,OAAO,IAAI,OAAO,CAAC,SAAS,YAAY,SAAS,GAAG,OAAO,GAAG,SAAS,CAAC;IAC7F,IAAI,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;IACxD,IAAI,OAAO,GAAG,IAAI,OAAO,CAAC,WAAW,IAAI,EAAE,CAAC,CAAC;;;;IAI7C,SAAS,CAAC,OAAO,GAAG,gBAAgB,CAAC,OAAO,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;;IAE7D,OAAO,SAAS,CAAC;GAClB;EACD,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC;;;;;;;;;;;;EAYpB,SAAS,QAAQ,CAAC,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE;IAC9B,IAAI;MACF,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE,CAAC;KACnD,CAAC,OAAO,GAAG,EAAE;MACZ,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;KACpC;GACF;;EAED,IAAI,sBAAsB,GAAG,gBAAgB,CAAC;EAC9C,IAAI,sBAAsB,GAAG,gBAAgB,CAAC;EAC9C,IAAI,iBAAiB,GAAG,WAAW,CAAC;EACpC,IAAI,iBAAiB,GAAG,WAAW,CAAC;;;;EAIpC,IAAI,gBAAgB,GAAG,EAAE,CAAC;;;;;;EAM1B,SAAS,SAAS,GAAG,EAAE;EACvB,SAAS,iBAAiB,GAAG,EAAE;EAC/B,SAAS,0BAA0B,GAAG,EAAE;;;;EAIxC,IAAI,iBAAiB,GAAG,EAAE,CAAC;EAC3B,iBAAiB,CAAC,cAAc,CAAC,GAAG,YAAY;IAC9C,OAAO,IAAI,CAAC;GACb,CAAC;;EAEF,IAAI,QAAQ,GAAG,MAAM,CAAC,cAAc,CAAC;EACrC,IAAI,uBAAuB,GAAG,QAAQ,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACzE,IAAI,uBAAuB;MACvB,uBAAuB,KAAK,EAAE;MAC9B,MAAM,CAAC,IAAI,CAAC,uBAAuB,EAAE,cAAc,CAAC,EAAE;;;IAGxD,iBAAiB,GAAG,uBAAuB,CAAC;GAC7C;;EAED,IAAI,EAAE,GAAG,0BAA0B,CAAC,SAAS;IAC3C,SAAS,CAAC,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;EACzD,iBAAiB,CAAC,SAAS,GAAG,EAAE,CAAC,WAAW,GAAG,0BAA0B,CAAC;EAC1E,0BAA0B,CAAC,WAAW,GAAG,iBAAiB,CAAC;EAC3D,0BAA0B,CAAC,iBAAiB,CAAC;IAC3C,iBAAiB,CAAC,WAAW,GAAG,mBAAmB,CAAC;;;;EAItD,SAAS,qBAAqB,CAAC,SAAS,EAAE;IACxC,CAAC,MAAM,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC,OAAO,CAAC,SAAS,MAAM,EAAE;MACnD,SAAS,CAAC,MAAM,CAAC,GAAG,SAAS,GAAG,EAAE;QAChC,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;OAClC,CAAC;KACH,CAAC,CAAC;GACJ;;EAED,OAAO,CAAC,mBAAmB,GAAG,SAAS,MAAM,EAAE;IAC7C,IAAI,IAAI,GAAG,OAAO,MAAM,KAAK,UAAU,IAAI,MAAM,CAAC,WAAW,CAAC;IAC9D,OAAO,IAAI;QACP,IAAI,KAAK,iBAAiB;;;QAG1B,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,IAAI,MAAM,mBAAmB;QACvD,KAAK,CAAC;GACX,CAAC;;EAEF,OAAO,CAAC,IAAI,GAAG,SAAS,MAAM,EAAE;IAC9B,IAAI,MAAM,CAAC,cAAc,EAAE;MACzB,MAAM,CAAC,cAAc,CAAC,MAAM,EAAE,0BAA0B,CAAC,CAAC;KAC3D,MAAM;MACL,MAAM,CAAC,SAAS,GAAG,0BAA0B,CAAC;MAC9C,IAAI,EAAE,iBAAiB,IAAI,MAAM,CAAC,EAAE;QAClC,MAAM,CAAC,iBAAiB,CAAC,GAAG,mBAAmB,CAAC;OACjD;KACF;IACD,MAAM,CAAC,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACrC,OAAO,MAAM,CAAC;GACf,CAAC;;;;;;EAMF,OAAO,CAAC,KAAK,GAAG,SAAS,GAAG,EAAE;IAC5B,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC;GACzB,CAAC;;EAEF,SAAS,aAAa,CAAC,SAAS,EAAE;IAChC,SAAS,MAAM,CAAC,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE;MAC5C,IAAI,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC;MACzD,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;QAC3B,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;OACpB,MAAM;QACL,IAAI,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC;QACxB,IAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;QACzB,IAAI,KAAK;YACL,OAAO,KAAK,KAAK,QAAQ;YACzB,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,SAAS,CAAC,EAAE;UACjC,OAAO,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,KAAK,EAAE;YACzD,MAAM,CAAC,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;WACxC,EAAE,SAAS,GAAG,EAAE;YACf,MAAM,CAAC,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;WACvC,CAAC,CAAC;SACJ;;QAED,OAAO,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,SAAS,EAAE;;;;;;;;;;;;;;;;UAgBrD,MAAM,CAAC,KAAK,GAAG,SAAS,CAAC;UACzB,OAAO,CAAC,MAAM,CAAC,CAAC;SACjB,EAAE,MAAM,CAAC,CAAC;OACZ;KACF;;IAED,IAAI,OAAO,MAAM,CAAC,OAAO,KAAK,QAAQ,IAAI,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE;MAC/D,MAAM,GAAG,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;KAC7C;;IAED,IAAI,eAAe,CAAC;;IAEpB,SAAS,OAAO,CAAC,MAAM,EAAE,GAAG,EAAE;MAC5B,SAAS,0BAA0B,GAAG;QACpC,OAAO,IAAI,OAAO,CAAC,SAAS,OAAO,EAAE,MAAM,EAAE;UAC3C,MAAM,CAAC,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;SACtC,CAAC,CAAC;OACJ;;MAED,OAAO,eAAe;;;;;;;;;;;;;QAapB,eAAe,GAAG,eAAe,CAAC,IAAI;UACpC,0BAA0B;;;UAG1B,0BAA0B;SAC3B,GAAG,0BAA0B,EAAE,CAAC;KACpC;;;;IAID,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;GACxB;;EAED,qBAAqB,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;EAC/C,aAAa,CAAC,SAAS,CAAC,mBAAmB,CAAC,GAAG,YAAY;IACzD,OAAO,IAAI,CAAC;GACb,CAAC;EACF,OAAO,CAAC,aAAa,GAAG,aAAa,CAAC;;;;;EAKtC,OAAO,CAAC,KAAK,GAAG,SAAS,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE;IAC5D,IAAI,IAAI,GAAG,IAAI,aAAa;MAC1B,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,WAAW,CAAC;KAC1C,CAAC;;IAEF,OAAO,OAAO,CAAC,mBAAmB,CAAC,OAAO,CAAC;QACvC,IAAI;QACJ,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,SAAS,MAAM,EAAE;UAChC,OAAO,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,EAAE,CAAC;SACjD,CAAC,CAAC;GACR,CAAC;;EAEF,SAAS,gBAAgB,CAAC,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE;IAChD,IAAI,KAAK,GAAG,sBAAsB,CAAC;;IAEnC,OAAO,SAAS,MAAM,CAAC,MAAM,EAAE,GAAG,EAAE;MAClC,IAAI,KAAK,KAAK,iBAAiB,EAAE;QAC/B,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;OACjD;;MAED,IAAI,KAAK,KAAK,iBAAiB,EAAE;QAC/B,IAAI,MAAM,KAAK,OAAO,EAAE;UACtB,MAAM,GAAG,CAAC;SACX;;;;QAID,OAAO,UAAU,EAAE,CAAC;OACrB;;MAED,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;MACxB,OAAO,CAAC,GAAG,GAAG,GAAG,CAAC;;MAElB,OAAO,IAAI,EAAE;QACX,IAAI,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;QAChC,IAAI,QAAQ,EAAE;UACZ,IAAI,cAAc,GAAG,mBAAmB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;UAC5D,IAAI,cAAc,EAAE;YAClB,IAAI,cAAc,KAAK,gBAAgB,EAAE,SAAS;YAClD,OAAO,cAAc,CAAC;WACvB;SACF;;QAED,IAAI,OAAO,CAAC,MAAM,KAAK,MAAM,EAAE;;;UAG7B,OAAO,CAAC,IAAI,GAAG,OAAO,CAAC,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC;;SAE5C,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,OAAO,EAAE;UACrC,IAAI,KAAK,KAAK,sBAAsB,EAAE;YACpC,KAAK,GAAG,iBAAiB,CAAC;YAC1B,MAAM,OAAO,CAAC,GAAG,CAAC;WACnB;;UAED,OAAO,CAAC,iBAAiB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;SAExC,MAAM,IAAI,OAAO,CAAC,MAAM,KAAK,QAAQ,EAAE;UACtC,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;SACvC;;QAED,KAAK,GAAG,iBAAiB,CAAC;;QAE1B,IAAI,MAAM,GAAG,QAAQ,CAAC,OAAO,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;QAC9C,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;;;UAG5B,KAAK,GAAG,OAAO,CAAC,IAAI;cAChB,iBAAiB;cACjB,sBAAsB,CAAC;;UAE3B,IAAI,MAAM,CAAC,GAAG,KAAK,gBAAgB,EAAE;YACnC,SAAS;WACV;;UAED,OAAO;YACL,KAAK,EAAE,MAAM,CAAC,GAAG;YACjB,IAAI,EAAE,OAAO,CAAC,IAAI;WACnB,CAAC;;SAEH,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;UAClC,KAAK,GAAG,iBAAiB,CAAC;;;UAG1B,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;UACzB,OAAO,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;SAC1B;OACF;KACF,CAAC;GACH;;;;;;EAMD,SAAS,mBAAmB,CAAC,QAAQ,EAAE,OAAO,EAAE;IAC9C,IAAI,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAC/C,IAAI,MAAM,KAAK,SAAS,EAAE;;;MAGxB,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;;MAExB,IAAI,OAAO,CAAC,MAAM,KAAK,OAAO,EAAE;QAC9B,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,EAAE;;;UAG5B,OAAO,CAAC,MAAM,GAAG,QAAQ,CAAC;UAC1B,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;UACxB,mBAAmB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;;UAEvC,IAAI,OAAO,CAAC,MAAM,KAAK,OAAO,EAAE;;;YAG9B,OAAO,gBAAgB,CAAC;WACzB;SACF;;QAED,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;QACzB,OAAO,CAAC,GAAG,GAAG,IAAI,SAAS;UACzB,gDAAgD,CAAC,CAAC;OACrD;;MAED,OAAO,gBAAgB,CAAC;KACzB;;IAED,IAAI,MAAM,GAAG,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;;IAE9D,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;MAC3B,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;MACzB,OAAO,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;MACzB,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;MACxB,OAAO,gBAAgB,CAAC;KACzB;;IAED,IAAI,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC;;IAEtB,IAAI,EAAE,IAAI,EAAE;MACV,OAAO,CAAC,MAAM,GAAG,OAAO,CAAC;MACzB,OAAO,CAAC,GAAG,GAAG,IAAI,SAAS,CAAC,kCAAkC,CAAC,CAAC;MAChE,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;MACxB,OAAO,gBAAgB,CAAC;KACzB;;IAED,IAAI,IAAI,CAAC,IAAI,EAAE;;;MAGb,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;;;MAG1C,OAAO,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC;;;;;;;;MAQhC,IAAI,OAAO,CAAC,MAAM,KAAK,QAAQ,EAAE;QAC/B,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;QACxB,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;OACzB;;KAEF,MAAM;;MAEL,OAAO,IAAI,CAAC;KACb;;;;IAID,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;IACxB,OAAO,gBAAgB,CAAC;GACzB;;;;EAID,qBAAqB,CAAC,EAAE,CAAC,CAAC;;EAE1B,EAAE,CAAC,iBAAiB,CAAC,GAAG,WAAW,CAAC;;;;;;;EAOpC,EAAE,CAAC,cAAc,CAAC,GAAG,WAAW;IAC9B,OAAO,IAAI,CAAC;GACb,CAAC;;EAEF,EAAE,CAAC,QAAQ,GAAG,WAAW;IACvB,OAAO,oBAAoB,CAAC;GAC7B,CAAC;;EAEF,SAAS,YAAY,CAAC,IAAI,EAAE;IAC1B,IAAI,KAAK,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;;IAEhC,IAAI,CAAC,IAAI,IAAI,EAAE;MACb,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;KAC1B;;IAED,IAAI,CAAC,IAAI,IAAI,EAAE;MACb,KAAK,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;MAC3B,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;KAC1B;;IAED,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GAC7B;;EAED,SAAS,aAAa,CAAC,KAAK,EAAE;IAC5B,IAAI,MAAM,GAAG,KAAK,CAAC,UAAU,IAAI,EAAE,CAAC;IACpC,MAAM,CAAC,IAAI,GAAG,QAAQ,CAAC;IACvB,OAAO,MAAM,CAAC,GAAG,CAAC;IAClB,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC;GAC3B;;EAED,SAAS,OAAO,CAAC,WAAW,EAAE;;;;IAI5B,IAAI,CAAC,UAAU,GAAG,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;IACvC,WAAW,CAAC,OAAO,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;IACxC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;GAClB;;EAED,OAAO,CAAC,IAAI,GAAG,SAAS,MAAM,EAAE;IAC9B,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,KAAK,IAAI,GAAG,IAAI,MAAM,EAAE;MACtB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KAChB;IACD,IAAI,CAAC,OAAO,EAAE,CAAC;;;;IAIf,OAAO,SAAS,IAAI,GAAG;MACrB,OAAO,IAAI,CAAC,MAAM,EAAE;QAClB,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QACrB,IAAI,GAAG,IAAI,MAAM,EAAE;UACjB,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;UACjB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;UAClB,OAAO,IAAI,CAAC;SACb;OACF;;;;;MAKD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;MACjB,OAAO,IAAI,CAAC;KACb,CAAC;GACH,CAAC;;EAEF,SAAS,MAAM,CAAC,QAAQ,EAAE;IACxB,IAAI,QAAQ,EAAE;MACZ,IAAI,cAAc,GAAG,QAAQ,CAAC,cAAc,CAAC,CAAC;MAC9C,IAAI,cAAc,EAAE;QAClB,OAAO,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;OACtC;;MAED,IAAI,OAAO,QAAQ,CAAC,IAAI,KAAK,UAAU,EAAE;QACvC,OAAO,QAAQ,CAAC;OACjB;;MAED,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;QAC3B,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,GAAG,SAAS,IAAI,GAAG;UACjC,OAAO,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE;YAC5B,IAAI,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC,EAAE;cAC5B,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;cACzB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;cAClB,OAAO,IAAI,CAAC;aACb;WACF;;UAED,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;UACvB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;;UAEjB,OAAO,IAAI,CAAC;SACb,CAAC;;QAEF,OAAO,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;OACzB;KACF;;;IAGD,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC;GAC7B;EACD,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;;EAExB,SAAS,UAAU,GAAG;IACpB,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;GACzC;;EAED,OAAO,CAAC,SAAS,GAAG;IAClB,WAAW,EAAE,OAAO;;IAEpB,KAAK,EAAE,SAAS,aAAa,EAAE;MAC7B,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;MACd,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;;;MAGd,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;MACnC,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;MAClB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;;MAErB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;MACrB,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC;;MAErB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;;MAEvC,IAAI,CAAC,aAAa,EAAE;QAClB,KAAK,IAAI,IAAI,IAAI,IAAI,EAAE;;UAErB,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG;cACtB,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC;cACvB,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE;YAC1B,IAAI,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;WACxB;SACF;OACF;KACF;;IAED,IAAI,EAAE,WAAW;MACf,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;;MAEjB,IAAI,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;MACnC,IAAI,UAAU,GAAG,SAAS,CAAC,UAAU,CAAC;MACtC,IAAI,UAAU,CAAC,IAAI,KAAK,OAAO,EAAE;QAC/B,MAAM,UAAU,CAAC,GAAG,CAAC;OACtB;;MAED,OAAO,IAAI,CAAC,IAAI,CAAC;KAClB;;IAED,iBAAiB,EAAE,SAAS,SAAS,EAAE;MACrC,IAAI,IAAI,CAAC,IAAI,EAAE;QACb,MAAM,SAAS,CAAC;OACjB;;MAED,IAAI,OAAO,GAAG,IAAI,CAAC;MACnB,SAAS,MAAM,CAAC,GAAG,EAAE,MAAM,EAAE;QAC3B,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC;QACtB,MAAM,CAAC,GAAG,GAAG,SAAS,CAAC;QACvB,OAAO,CAAC,IAAI,GAAG,GAAG,CAAC;;QAEnB,IAAI,MAAM,EAAE;;;UAGV,OAAO,CAAC,MAAM,GAAG,MAAM,CAAC;UACxB,OAAO,CAAC,GAAG,GAAG,SAAS,CAAC;SACzB;;QAED,OAAO,CAAC,EAAE,MAAM,CAAC;OAClB;;MAED,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE;QACpD,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC/B,IAAI,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC;;QAE9B,IAAI,KAAK,CAAC,MAAM,KAAK,MAAM,EAAE;;;;UAI3B,OAAO,MAAM,CAAC,KAAK,CAAC,CAAC;SACtB;;QAED,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,IAAI,EAAE;UAC7B,IAAI,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,UAAU,CAAC,CAAC;UAC9C,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;;UAElD,IAAI,QAAQ,IAAI,UAAU,EAAE;YAC1B,IAAI,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,QAAQ,EAAE;cAC9B,OAAO,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;aACrC,MAAM,IAAI,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,UAAU,EAAE;cACvC,OAAO,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;aACjC;;WAEF,MAAM,IAAI,QAAQ,EAAE;YACnB,IAAI,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,QAAQ,EAAE;cAC9B,OAAO,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;aACrC;;WAEF,MAAM,IAAI,UAAU,EAAE;YACrB,IAAI,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,UAAU,EAAE;cAChC,OAAO,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;aACjC;;WAEF,MAAM;YACL,MAAM,IAAI,KAAK,CAAC,wCAAwC,CAAC,CAAC;WAC3D;SACF;OACF;KACF;;IAED,MAAM,EAAE,SAAS,IAAI,EAAE,GAAG,EAAE;MAC1B,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE;QACpD,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC/B,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,CAAC,IAAI;YACzB,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC;YAChC,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC,UAAU,EAAE;UAChC,IAAI,YAAY,GAAG,KAAK,CAAC;UACzB,MAAM;SACP;OACF;;MAED,IAAI,YAAY;WACX,IAAI,KAAK,OAAO;WAChB,IAAI,KAAK,UAAU,CAAC;UACrB,YAAY,CAAC,MAAM,IAAI,GAAG;UAC1B,GAAG,IAAI,YAAY,CAAC,UAAU,EAAE;;;QAGlC,YAAY,GAAG,IAAI,CAAC;OACrB;;MAED,IAAI,MAAM,GAAG,YAAY,GAAG,YAAY,CAAC,UAAU,GAAG,EAAE,CAAC;MACzD,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;MACnB,MAAM,CAAC,GAAG,GAAG,GAAG,CAAC;;MAEjB,IAAI,YAAY,EAAE;QAChB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,IAAI,GAAG,YAAY,CAAC,UAAU,CAAC;QACpC,OAAO,gBAAgB,CAAC;OACzB;;MAED,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;KAC9B;;IAED,QAAQ,EAAE,SAAS,MAAM,EAAE,QAAQ,EAAE;MACnC,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;QAC3B,MAAM,MAAM,CAAC,GAAG,CAAC;OAClB;;MAED,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO;UACvB,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE;QAC9B,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC;OACxB,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;QACnC,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC;QAClC,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC;QACvB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;OACnB,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,QAAQ,EAAE;QAC/C,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAC;OACtB;;MAED,OAAO,gBAAgB,CAAC;KACzB;;IAED,MAAM,EAAE,SAAS,UAAU,EAAE;MAC3B,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE;QACpD,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC/B,IAAI,KAAK,CAAC,UAAU,KAAK,UAAU,EAAE;UACnC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,UAAU,EAAE,KAAK,CAAC,QAAQ,CAAC,CAAC;UAChD,aAAa,CAAC,KAAK,CAAC,CAAC;UACrB,OAAO,gBAAgB,CAAC;SACzB;OACF;KACF;;IAED,OAAO,EAAE,SAAS,MAAM,EAAE;MACxB,KAAK,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE;QACpD,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QAC/B,IAAI,KAAK,CAAC,MAAM,KAAK,MAAM,EAAE;UAC3B,IAAI,MAAM,GAAG,KAAK,CAAC,UAAU,CAAC;UAC9B,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;YAC3B,IAAI,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC;YACxB,aAAa,CAAC,KAAK,CAAC,CAAC;WACtB;UACD,OAAO,MAAM,CAAC;SACf;OACF;;;;MAID,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;KAC1C;;IAED,aAAa,EAAE,SAAS,QAAQ,EAAE,UAAU,EAAE,OAAO,EAAE;MACrD,IAAI,CAAC,QAAQ,GAAG;QACd,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC;QAC1B,UAAU,EAAE,UAAU;QACtB,OAAO,EAAE,OAAO;OACjB,CAAC;;MAEF,IAAI,IAAI,CAAC,MAAM,KAAK,MAAM,EAAE;;;QAG1B,IAAI,CAAC,GAAG,GAAG,SAAS,CAAC;OACtB;;MAED,OAAO,gBAAgB,CAAC;KACzB;GACF,CAAC;CACH;;;;EAIC,OAAOwC,cAAM,KAAK,QAAQ,GAAGA,cAAM;EACnC,OAAO,MAAM,KAAK,QAAQ,GAAG,MAAM;EACnC,OAAO,IAAI,KAAK,QAAQ,GAAG,IAAI,GAAGC,cAAI;CACvC,CAAC;;;AC/tBF;;AAEA,IAAI,CAAC;EACH,OAAOD,cAAM,KAAK,QAAQ,GAAGA,cAAM;EACnC,OAAO,MAAM,KAAK,QAAQ,GAAG,MAAM;EACnC,OAAO,IAAI,KAAK,QAAQ,GAAG,IAAI,GAAGC,cAAI,CAAC;;;;AAIzC,IAAI,UAAU,GAAG,CAAC,CAAC,kBAAkB;EACnC,MAAM,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;;;AAGnE,IAAI,UAAU,GAAG,UAAU,IAAI,CAAC,CAAC,kBAAkB,CAAC;;;AAGpD,CAAC,CAAC,kBAAkB,GAAG,SAAS,CAAC;;AAEjC,iBAAc,GAAGC,OAAoB,CAAC;;AAEtC,IAAI,UAAU,EAAE;;EAEd,CAAC,CAAC,kBAAkB,GAAG,UAAU,CAAC;CACnC,MAAM;;EAEL,IAAI;IACF,OAAO,CAAC,CAAC,kBAAkB,CAAC;GAC7B,CAAC,MAAM,CAAC,EAAE;IACT,CAAC,CAAC,kBAAkB,GAAG,SAAS,CAAC;GAClC;CACF;;AC9BD,SAAc,GAAGA,aAA8B;;ACA/C;;AAEA,AAAe,SAASC,eAAT,CAA0BC,MAA1B,EAAkC;MACzCC,QAAQ,EAAd;;MAEID,UAAUA,OAAOE,MAArB,EAA6B;;QAErBC,QAAQH,OAAOI,KAAP,CAAa,GAAb,CAAd;;SAEK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,MAAMD,MAA1B,EAAkCG,GAAlC,EAAuC;UAC/BC,UAAUH,MAAME,CAAN,EAASD,KAAT,CAAe,GAAf,CAAhB;UACMnE,MAAMqE,QAAQ,CAAR,EAAWxE,OAAX,CAAmB,QAAnB,EAA6B,IAA7B,EAAmCyE,IAAnC,EAAZ;UACMC,OAAOF,QAAQ,CAAR,EAAWxE,OAAX,CAAmB,YAAnB,EAAiC,IAAjC,EAAuCyE,IAAvC,EAAb;YACMC,IAAN,IAAcvE,GAAd;;;;SAIGgE,KAAP;;;ACTF;;;;;;;;;IAQqBQ;;;;;;;;;;;;;;+BAWAC,MAAuC;UAAjChB,IAAiC,uEAA1B,EAA0B;UAAtBiB,oBAAsB;;UACpD,CAACD,IAAL,EAAW;cACH,IAAIpB,KAAJ,CAAU,gDAAV,CAAN;;;;;aAKK,UAAUsB,EAAV,EAAc;;YAEfC,mBAAJ;YAAgBC,oBAAhB;YAA6BC,gBAA7B;;YAEI,gBAAgB3B,KAApB,EAA2B;wBACX,IAAd;uBACa,EAAb;SAFF,MAGO,IAAI,gBAAgBqB,QAApB,EAA8B;wBACrB,KAAKO,KAAnB;uBACa,KAAKtB,IAAlB;SAFK,MAGA,IAAI,gBAAgBuB,MAApB,EAA4B;wBACnB,KAAK1B,QAAQ2B,QAAb,EAAuBF,KAArC;uBACa,KAAKzB,QAAQ2B,QAAb,EAAuBxB,IAApC;;;kBAGQmB,aAAanB,IAAvB;;YAEIkB,EAAJ,EAAQ;cACF,CAACvB,SAASuB,EAAT,CAAL,EAAmB;kBACX,IAAIhG,SAAJ,CAAc,sBAAd,CAAN;;2BAEagB,mBAAmBgF,EAAnB,CAAf;;;YAGIO,YAAYR,uBACdA,qBAAqBF,QAArB,CADc,GAEdA,QAFJ;eAGO,IAAIU,SAAJ,CAAcL,WAAd,EAA2BC,OAA3B,EAAoCL,IAApC,CAAP;OA3BF;;;;;;;;;;;;;;;;oBAyCWM,KAAb,EAAoBtB,IAApB,EAA0BgB,IAA1B,EAAgC;;;QAC1B,EAAEM,SAASA,iBAAiB5B,KAA5B,CAAJ,EAAwC;YAChC,IAAIxE,SAAJ,CAAc,iDAAd,CAAN;;;QAGE,CAACyE,SAASK,IAAT,CAAL,EAAqB;YACb,IAAI9E,SAAJ,CAAc,mCAAd,CAAN;;;;SAIGoG,KAAL,GAAaA,KAAb;;;SAGKtB,IAAL,SAAeA,KAAK,CAAL,MAAY,GAAZ,GAAkB,GAAlB,GAAwB,EAAvC,IAA4CA,IAA5C;;;;QAIIgB,SAASA,SAASO,MAAT,IAAmBP,KAAKU,SAAL,YAA0BH,MAAtD,CAAJ,EAAmE;WAC5DP,IAAL,GAAYA,IAAZ;;;;;;;;;;;;;;gCAUoB;UAAbW,MAAa,uEAAJ,EAAI;;UAClB,EAAE,KAAKX,IAAL,IAAaW,kBAAkB,KAAKX,IAAtC,CAAJ,EAAiD;eACxCW,MAAP;;aAEKA,OAAOpC,IAAP,EAAP;;;;;;;;;;;;;;;gCAYWF,UAAU;;;UACjBA,YAAY,KAAK2B,IAArB,EAA2B;YACrB5C,MAAMC,OAAN,CAAcgB,QAAd,CAAJ,EAA6B;iBACpBA,SAASzD,GAAT,CAAa,KAAKgG,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAb,CAAP;;;YAGExC,SAAS1B,IAAb,EAAmB;;;mBAGRiE,WAAT,GAAuB;mBAAMvC,SAASE,IAAT,GAC1BxC,IAD0B,CACrB,MAAK6E,WAAL,CAAiBC,IAAjB,OADqB,CAAN;WAAvB;SAHF,MAKO;;;cAGDR,UAAU,KAAKrB,IAAnB;;;cAGIX,SAAS6B,EAAT,IAAeG,QAAQS,OAAR,CAAgBzC,SAAS6B,EAAzB,MAAiC,CAAC,CAArD,EAAwD;6BACvC7B,SAAS6B,EAAxB;;;cAGIa,cAAc,IAAIhB,QAAJ,CAAa,KAAKO,KAAlB,EAAyBD,OAAzB,EAAkC,KAAKL,IAAvC,CAApB;cACMgB,aAAa,KAAKhB,IAAxB;iBACO,IAAIgB,UAAJ,CAAeD,WAAf,EAA4B1C,QAA5B,CAAP;;;;aAIGA,QAAP;;;;;;;;;;;;;;2BAWM1B,MAAMrB,SAASK,UAAU;UAC3B,CAACgB,IAAD,IAASa,WAAWb,IAAX,CAAb,EAA+B;cACvB,IAAIzC,SAAJ,CAAc,kCAAd,CAAN;;;aAGK,KAAK+E,QAAL,CAAc;aACd,KAAKD,IADS;kBAAA;gBAGX;OAHH,EAIJ1D,OAJI,EAIKK,QAJL,CAAP;;;;;;;;;;;;;yBAcIL,SAASK,UAAU;aAChB,KAAKsD,QAAL,CAAc;aACd,KAAKD,IADS;gBAEX;OAFH,EAGJ1D,OAHI,EAGKK,QAHL,CAAP;;;;;;;;;;;;;;2BAcMgB,MAAMrB,SAASK,UAAU;UAC3B,CAACgB,IAAD,IAASa,WAAWb,IAAX,CAAb,EAA+B;cACvB,IAAIzC,SAAJ,CAAc,kCAAd,CAAN;;;aAGK,KAAK+E,QAAL,CAAc;aACd,KAAKD,IADS;kBAAA;gBAGX;OAHH,EAIJ1D,OAJI,EAIKK,QAJL,CAAP;;;;;;;;;;;;SAcD;4BAAWL,SAASK,UAAU;aACtB,KAAKsD,QAAL,CAAc;aACd,KAAKD,IADS;gBAEX;OAFH,EAGJ1D,OAHI,EAGKK,QAHL,CAAP;;;;;;;;;;;;;;;;;;;;;;;;;;;YAyBYL,8EAAU;;;;;;+BACDA,QAAQ8C;;;;;;4CAIZ,KAAK6C,YAAL,CAAkB,EAAC1F,KAAK,KAAKyD,IAAX,EAAlB,EAAoCZ,YAApC,EAAkD9C,OAAlD;;;;;uBACX+C,SAAS6C;;;qBAER7C,SAAS8C;;;;;;4CACG,KAAKF,YAAL,CAAkB,EAACzF,QAAQ6C,SAAS8C,IAAlB,EAAlB,EAA2C/C,YAA3C;;;;;uBACXC,SAAS6C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gEAoBHE;YAAgBC,kFAAc;YAAI1F;;;;;;oBAC5C6B,WAAW6D,WAAX,CAAJ,EAA6B;6BAChBA,WAAX;;;;0BAIc7H,OAAOC,MAAP,CACd,EADc,EAEd4H,WAFc,EAGdD,cAHc,EAId;0BACU,KAAKd,KAAL,CAAW7D;iBALP;;;;qBAUZnB,QAAQqB;;;;;;uBACW,KAAK2E,SAAL,CAAehG,QAAQqB,IAAvB;;;wBAAbA;;;;;uBAKelB,IAAIH,OAAJ;;;;;uBACI,KAAKsF,WAAL,CAAiBvC,QAAjB;;;;kDACpBlC,QAAQR,QAAR,EAAkB4F,YAAlB;;;;;sBAEDlF,QAAQV,QAAR;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gEAaUyF,gBAAgBhD;YAAciD,kFAAc;;;;;;uBACjD7H,OAAOC,MAAP,CAAc,EAAE2E,cAAc,IAAhB,EAAd,EAAsCgD,cAAtC;;uBACU,KAAKnC,QAAL,CAAcF,IAAd,EAAoBsC,WAApB;;;;6BACJhC,gBAAgBhB,SAAS9B,OAAT,CAAiBiF,GAAjB,CAAqB,MAArB,CAAhB;uBACNC,WAAWN,IAAX,IAAmBO,mBAAmBD,WAAWN,IAA9B;;uBACV/C,eAAeC,QAAf,GAA0BA,SAASE,IAAT;;;;kDACzC,EAAE2C,cAAF,EAAUC,UAAV;;;;;;;;;;;;;;;;;;;;ACpTX;;;;;;IAKqBZ;;;;;;;;kBAQNC,QAAb,EAAkC;QAAX7D,IAAW,uEAAJ,EAAI;;;QAC5B,EAAE6D,YAAYA,oBAAoBT,QAAlC,CAAJ,EAAiD;YACzC,IAAInB,KAAJ,CAAU,8BAAV,CAAN;;;;;SAKGC,QAAQ2B,QAAb,IAAyBA,QAAzB;;;WAGO/G,MAAP,CAAc,IAAd,EAAoBkD,IAApB;;;;;;;;;;;;2BAQM;aACCnD,OAAOmB,OAAP,CAAe,IAAf,EACJgH,MADI,CACG,UAACC,GAAD;;YAAOC,CAAP;YAAUC,CAAV;;eAAiBtI,OAAOC,MAAP,CAAcmI,GAAd,qBAAqBC,CAArB,EAAyBC,CAAzB,EAAjB;OADH,EACkD,EADlD,CAAP;;;;;;;;;;;;;;6BAYoC;;;UAA9BnF,IAA8B,uEAAvB,KAAK4B,IAAL,EAAuB;UAAV5C,QAAU;;aAC7B,KAAKkD,QAAQ2B,QAAb,EAAuBuB,MAAvB,CAA8BpF,IAA9B,EAAoChB,QAApC,EACJI,IADI,CACC,mBAAW;;eAERtC,MAAP,QAAoBuI,OAApB;eACOA,OAAP;OAJG,CAAP;;;;;;;;;;;SAcD;4BAAWrG,UAAU;aACb,KAAKkD,QAAQ2B,QAAb,EAAuByB,MAAvB,CAA8BtG,QAA9B,CAAP;;;;;;ACxDJ,IAAMqD,SAAO,aAAb;;;;;;;;;IAQqBkD;;;;;;;;;;;;;;;;;;;;sCAUO;aACjB;gBAAA,oBACKhC,EADL,EACS;cACNiC,WAAW,gBAAgBzD,KAAhB,GAAwB,KAAKG,QAAQG,IAAb,CAAxB,GAA6C,EAA9D;;;;;iBAKOxF,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoBF,QAApB,EAA8BC,WAAWnD,MAAzC,EAA+CqD,IAA/C,CAAoD,IAApD,EAA0DnC,EAA1D,CADK,EAEL;kBAAA,oBACmB;;;qBACR,kCAASQ,SAAT,CAAmB4B,MAAnB,EACJD,IADI,+BACC,IADD,2BACUE,8CADV,GAAP;aAFJ;kBAAA,oBAKmB;;;qBACR,kCAAS7B,SAAT,CAAmBqB,MAAnB,EACJM,IADI,+BACC,IADD,2BACUE,8CADV,GAAP;;WARC,CAAP;;OAPJ;;;;EAXkChC;;AAoCtC,AAgBA,SAASgC,kBAAT,CAA6B7F,IAA7B,EAA4C;MAExCiC,SAASjC,IAAT,KACA,OAAOA,IAAP,KAAgB,QADhB,IAEA,OAAOA,IAAP,KAAgB,SAHlB,EAIE;;WAEO,CAAC,EAAEzB,OAAOyB,IAAT,EAAD,CAAP;GANF,MAOO,IAAIzC,cAAcyC,IAAd,CAAJ,EAAyB;QAC1BA,KAAK9C,cAAL,CAAoB,OAApB,CAAJ,EAAkC;;aAEzB,CAAC8C,IAAD,CAAP;KAFF,MAGO;;aAEElD,OAAOmB,OAAP,CAAe+B,IAAf,EAAqB9B,GAArB,CAAyB;eAAQ;eACjC4H,IAAI,CAAJ,CADiC;iBAE/BA,IAAI,CAAJ;SAFuB;OAAzB,CAAP;;;;oCAdgCC,IAAM;QAAA;;;UAqBlC/F,IAAR,SAAiB+F,IAAjB;;;ACxFF;;;;;;AAMA,AAAe,SAASC,kBAAT,GAA+B;SACrC,IAAIxF,OAAJ,CAAY,UAACC,OAAD,EAAUU,MAAV,EAAqB;QAClC,OAAO8E,MAAP,KAAkB,WAAlB,IAAiCA,OAAOC,SAAP,CAAiBC,WAAtD,EAAmE;UAC3DC,qBAAqB;oBACb,CADa;iBAEhB,KAFgB;4BAGL;OAHtB;;aAMOF,SAAP,CAAiBC,WAAjB,CAA6BH,kBAA7B,CACEvF,OADF,EAEE;eAAOU,OAAOY,IAAIsE,OAAX,CAAP;OAFF,EAGED,kBAHF;KAPF,MAYO;aACE,gCAAP;;GAdG,CAAP;;;ACPF;;;;;;;;;;;;;;;;;AAiBA,SAAS,WAAW,CAAC,KAAK,EAAE;EAC1B,OAAO,KAAK,KAAK,SAAS,CAAC;CAC5B;;ACTD,IAAM9D,SAAO,gBAAb;;;;;;;;IAOqBgE;;;;;;;;;;;;;;;;;;;;sCAUO;aACjB;cAAA,kBACGC,UADH,EACe/C,EADf,EACmB;cAClB,CAAC+C,UAAL,EAAiB;kBACT,IAAI/I,SAAJ,CAAc,8BAAd,CAAN;;;cAGE,CAACyE,SAASsE,UAAT,CAAL,EAA2B;kBACnB,IAAI/I,SAAJ,CAAc,mCAAd,CAAN;;;cAGIgJ,WAAWlE,OAAK5D,OAAL,CAAa,OAAb,EAAsB6H,UAAtB,CAAjB;cACMd,WAAW,gBAAgBzD,KAAhB,GAAwB,KAAKG,QAAQG,IAAb,CAAxB,GAA6C,EAA9D;cACMmE,UAAU,IAAhB;;;;;iBAKO3J,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoBY,MAApB,EAA4Bb,WAAWe,QAAvC,EAAiDb,IAAjD,CAAsD,IAAtD,EAA4DnC,EAA5D,CADK,EAEL;kBAAA,oBACmB;gDAANkD,IAAM;oBAAA;;;qBACRC,aAAahB,IAAb,sBAAkB,IAAlB,EAAwBc,OAAxB,EAAiCF,UAAjC,SAAgDG,IAAhD,EAAP;;WAJC,CAAP;;OAjBJ;;;;EAXgC7C;;AAyCpC,AASA,SAAS8C,YAAT,CAAuBC,MAAvB,EAA+BL,UAA/B,EAAoD;qCAANG,IAAM;QAAA;;;4BAC5Bb,sCAAsBa,IAAtB,CAD4B;;MAC7C1G,IAD6C;MACpC+F,IADoC;;4BAElCA,IAFkC;MAE7CnH,OAF6C;;;;;SAK3C8B,MAAMC,OAAN,CAAcX,IAAd,IACHA,KAAK9B,GAAL,CAAS;WAAU2I,WAAWC,MAAX,EAAmBF,MAAnB,EAA2BL,UAA3B,CAAV;GAAT,CADG,GAEHvG,OAAO6G,WAAW7G,IAAX,EAAiB4G,MAAjB,EAAyBL,UAAzB,CAFX;;MAIMQ,aAAa1D,SAASW,SAAT,CAAmB4B,MAAnB,CAA0BzB,IAA1B,CAA+B,IAA/B,CAAnB;MACM6C,cAAc,SAAdA,WAAc;YAAOhH,IAAP,2BAAgB+F,IAAhB;GAApB;;MAEIkB,eAAerI,OAAf,CAAJ,EAA6B;WACpBoH,qBACJ3G,IADI,CACC,oBAAY;aACT6H,mBAAmBlH,IAAnB,EAAyBmH,QAAzB,CAAP;aACOJ,8CAAcC,aAAd,EAAP;KAHG,EAKJtH,KALI,CAKE,eAAO;cACJ0H,IAAR,8BAAwCrF,GAAxC;aACOgF,8CAAcC,aAAd,EAAP;KAPG,CAAP;GADF,MAUO;WACED,8CAAcC,aAAd,EAAP;;;;;;;;;;;;;;AAcJ,SAASnB,oBAAT,GAAsC;qCAANa,IAAM;QAAA;;;MAChCW,WAAWX,KAAK,CAAL,CAAf;MACIY,YAAYD,QAAZ,KAAyBvG,WAAWuG,QAAX,CAA7B,EAAmD;SAC5CE,OAAL,CAAa,EAAb;;SAEKb,IAAP;;;;;;;;;;;;;AAaF,SAASG,UAAT,CAAqB7G,IAArB,EAA2B4G,MAA3B,EAAmCL,UAAnC,EAA+C;MACvCO,SAAShK,OAAOC,MAAP,CAAc,EAAd,EAAkBiD,IAAlB,CAAf;;;SAGOsD,IAAP,GAAciD,eAAe,KAAf,IAAwBA,UAAxB,IAAsCvG,KAAKsD,IAA3C,IAAmD,EAAjE;;;MAGMkE,mBAAmBC,cAAcb,MAAd,CAAzB;MACIY,gBAAJ,EAAsB;WACbA,gBAAP,IAA2BZ,OAAOpD,EAAlC;;;SAGKsD,MAAP;;;;;;;;;;AAUF,SAASW,aAAT,CAAwBb,MAAxB,EAAgC;SACvBA,kBAAkB/C,MAAlB,GACH+C,OAAOc,WAAP,CAAmBtE,IAAnB,CAAwBuE,iBAAxB,EADG,GAEH,EAFJ;;;;;;;;;;AAYF,SAASV,cAAT,CAAyBrI,OAAzB,EAAkC;SACzBA,WAAW,CAAC0I,YAAY1I,QAAQuH,WAApB,CAAZ,GACHvH,QAAQuH,WADL,GAEHtJ,SAASsJ,WAFb;;;;;;;;;;AAYF,SAASe,kBAAT,CAA6BlH,IAA7B,EAAmCmH,QAAnC,EAA6C;MACrCL,SAAShK,OAAOC,MAAP,CAAc,EAAd,EAAkBiD,IAAlB,CAAf;SACO4H,QAAP,GAAkB;cACNT,SAASU,MAAT,CAAgBC,QADV;eAELX,SAASU,MAAT,CAAgBE;GAF7B;SAIOC,cAAP,GAAwB,QAAxB;SACOlB,MAAP;;;ACjLF;;;;;;;;;;;;;;;;AAgBA,AAAO,SAASmB,cAAT,CAAyBC,QAAzB,EAAmC;MAClCC,oBAAoBD,SAAShK,GAAT,CAAa;WAAKkK,EAAEC,eAAF,EAAL;GAAb,CAA1B;MACMC,kBAAkBxL,OAAOC,MAAP,gBAAc,EAAd,2BAAqBoL,iBAArB,GAAxB;SACO;WAAcI,MAAMD,eAAN;;;;;;;;;MAAqCE,UAArC,EAAd;GAAP;;;;;;;;;;;AAWF,AAAe,SAASD,KAAT,CAAgBE,SAAhB,EAAyC;MAAdC,KAAc,uEAAN,IAAM;;SAC/C,UAACC,MAAD,EAAY;;;;;;2BACIC,QAAQC,OAAR,CAAgBJ,SAAhB,CAArB,8HAAiD;YAAxCK,QAAwC;;eACxCC,cAAP,CACEL,QAAQC,OAAO3E,SAAf,GAA2B2E,MAD7B,EAEEG,QAFF,EAGE,EAAEvK,OAAOkK,UAAUK,QAAV,CAAT,EAHF;;;;;;;;;;;;;;;;;WAMKH,MAAP;GARF;;;ACzBF,IAAMrG,OAAO,WAAb;AACA,IAAM0G,mBAAmBf,eAAe,CACtCzC,QADsC,EAEtCc,MAFsC,CAAf,CAAzB;;;;;;;;IAUqB2C;;;;;;;;;;;;;;;;;sCAOO;aACjB;iBACI5F,SAASqC,UAAT,CAAoBuD,OAApB,EAA6B3G,IAA7B,EAAmC0G,gBAAnC;OADX;;;;EARiCA,iBAAiBnF,MAAjB;;ACNrC,IAAMvB,SAAO,YAAb;;;;;;;;;IAQqB4G;;;;;;;;;;;;;;;;;;;;sCAUO;aACjB;gBAAA,sBACO;;cAENjH,SAASkH,UAAU,CAAV,CAAT,CAAJ,EAA4B;kBACpB,IAAI3L,SAAJ,CAAc,2CAAd,CAAN;;;cAGIiI,WAAW,gBAAgBzD,KAAhB,GAAwB,KAAKG,QAAQG,IAAb,CAAxB,GAA6C,EAA9D;;;;;iBAKOxF,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoBwD,QAApB,EAA8BzD,WAAWnD,MAAzC,EAA+CqD,IAA/C,CAAoD,IAApD,CADK,EAEL;kBAAA,oBACmB;gDAANe,IAAM;oBAAA;;;qBACR0C,eAAezD,IAAf,wBAAoB,IAApB,SAA6Be,IAA7B,EAAP;;WAJC,CAAP;;OAZJ;;;;EAXkC7C;;AAoCtC,AAOA,SAASuF,cAAT,GAAkC;4BACVvD,gDADU;;MAC3B7F,IAD2B;MAClB+F,IADkB;;MAE1BsD,aAAahG,SAASW,SAAT,CAAmBqB,MAAnB,CAA0BlB,IAA1B,CAA+B,IAA/B,CAAnB;MACM6C,cAAc,SAAdA,WAAc;YAAOhH,IAAP,2BAAgB+F,IAAhB;GAApB;;MAEIkB,iBAAejH,IAAf,CAAJ,EAA0B;WACjBgG,qBACJ3G,IADI,CACC,oBAAY;WACX,CAAL,IAAUiK,aAAatJ,KAAK,CAAL,CAAb,EAAsBmH,QAAtB,CAAV;aACOkC,8CAAcrC,aAAd,EAAP;KAHG,EAKJtH,KALI,CAKE,eAAO;cACJ0H,IAAR,8BAAwCrF,GAAxC;aACOsH,8CAAcrC,aAAd,EAAP;KAPG,CAAP;GADF,MAUO;WACEqC,8CAAcrC,aAAd,EAAP;;;;;;;;;;;;;;;AAeJ,SAASnB,oBAAT,GAAsC;qCAANa,IAAM;QAAA;;;MAChCW,WAAWX,KAAK,CAAL,CAAf;MACInJ,cAAc8J,QAAd,CAAJ,EAA6B;SACtB,CAAL,IAAU,CAACA,QAAD,CAAV;GADF,MAEO,IAAIC,YAAYD,QAAZ,KAAyBvG,WAAWuG,QAAX,CAA7B,EAAmD;SACnDE,OAAL,CAAa,EAAb;;SAEKb,IAAP;;;;;;;;;;AAUF,SAASO,gBAAT,CAAyBjH,IAAzB,EAA+B;SACtBA,KAAK8C,MAAL,KAAgB,CAAhB,IAAqBjG,SAASsJ,WAArC;;;;;;;;;;AAUF,SAASmD,YAAT,CAAuBtJ,IAAvB,EAA6BmH,QAA7B,EAAuC;MAC/BS,WAAW9K,OAAOC,MAAP,CAAc,EAAd,EAAkBiD,IAAlB,CAAjB;WACSmH,QAAT,GAAoB;UACZ,OADY;iBAEL,CAACA,SAASU,MAAT,CAAgBE,SAAjB,EAA4BZ,SAASU,MAAT,CAAgBC,QAA5C;GAFf;SAIOF,QAAP;;;ACxHF,IAAMtF,SAAO,QAAb;AACA,IAAMiH,gBAAgBtB,eAAe,CACnCzC,QADmC,EAEnCc,MAFmC,EAGnC4C,QAHmC,CAAf,CAAtB;;;;;;;;IAWqBM;;;;;;;;;;;;;;;;;sCAOO;aACjB;cACCnG,SAASqC,UAAT,CAAoB8D,IAApB,EAA0BlH,MAA1B,EAAgCiH,aAAhC;OADR;;;;EAR8BA,cAAc1F,MAAd;;ACblC,IAAMvB,SAAO,cAAb;AACA,IAAMmH,sBAAsBxB,eAAe,CACzCuB,IADyC,EAEzClD;;CAF0B,CAA5B;;;;;;;;;;;;;;IAiBqBoD;;;;;;;;;;;;;;;;;sCAOO;aACjB;kBAAA,sBACOlG,EADP,EACW;;iBAEP1G,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoBgE,UAApB,EAAgCpH,MAAhC,EAAsCmH,mBAAtC,EACG9D,IADH,CACQ,IADR,EACcnC,EADd,CADK,EAGLkG,WAAWrB,eAAX,EAHK,CAAP;;OAHJ;;;;EARoCoB,oBAAoB5F,MAApB;;AAqBxC,AACA0E,MAAMmB,WAAWrB,eAAX,EAAN,EAAoCqB,UAApC;;ACzCA,IAAMpH,SAAO,UAAb;;;;;;;;;;IASqBqH;;;;;;;;;;;;;;;;;;sCAQO;aACjB;kBAAA,sBACOnG,EADP,EACW;iBACP1G,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoBiE,UAApB,EAAgCrH,MAAhC,EAAsCqD,IAAtC,CAA2C,IAA3C,EAAiDnC,EAAjD,CADK,EAEL;gBAAA,kBACiB;gDAANkD,IAAM;oBAAA;;;qBACNkD,eAAejE,IAAf,wBAAoB,IAApB,EAA0BnC,EAA1B,SAAiCkD,IAAjC,EAAP;;WAJC,CAAP;;OAFJ;;;;EAToC7C;;AAwBxC,AAOA,SAAS+F,cAAT,CAAyBpG,EAAzB,EAAsC;;;qCAANkD,IAAM;QAAA;;;MAChC,CAAClD,EAAL,EAAS;;;WACA,kCAASQ,SAAT,CAAmB6F,IAAnB,EAAwBlE,IAAxB,+BAA6B,IAA7B,SAAsCe,IAAtC,EAAP;GADF,MAEO;QACCoD,iBAAiBjE,qBAAmBrC,EAAnB,mBAA0BkD,IAA1B,CAAvB;WACO,IAAIlG,OAAJ,CAAY,UAACC,OAAD,EAAUU,MAAV,EAAqB;;;yCAC7B6C,SAAT,CAAmB6F,IAAnB,EAAwBlE,IAAxB,iEAAsCmE,cAAtC,IACGzK,IADH,CACQ,uBAAe;YACf,CAAC0K,YAAYjH,MAAjB,EAAyB;;iBAEhB;oBACG,GADH;oBAEG,CAAC,gCAAD;WAFV;;gBAKMiH,YAAY,CAAZ,CAAR;OATJ;KADK,CAAP;;;;;;;;;;;;AAwBJ,SAASlE,oBAAT,CAA6BrC,EAA7B,EAAiC;SACxB,YAAa;uCAATkD,IAAS;UAAA;;;QACd9H,gBAAJ;QACIyI,WAAWX,KAAK,CAAL,CAAf;;QAEIY,YAAYD,QAAZ,KAAyBvG,WAAWuG,QAAX,CAA7B,EAAmD;gBACvC,EAAV;WACKE,OAAL,CAAa3I,OAAb;KAFF,MAGO;gBACKyI,QAAV;;;YAGMxI,GAAR,GAAcyD,MAAd;YACQvE,MAAR,GAAiBjB,OAAOC,MAAP,CACf,EAAE8D,QAAQ,EAAEuC,MAAM4B,mBAAmBxB,EAAnB,CAAR,EAAV,EADe,EAEf5E,QAAQb,MAFO,CAAjB;;WAKO2I,IAAP;GAjBF;;;ACvEF,IAAMpE,UAAO,SAAb;;IAEqB0H;;;;;;;;;;sCACO;aACjB;cAAA,oBACK;cACJ/H,SAASkH,UAAU,CAAV,CAAT,CAAJ,EAA4B;kBACpB,IAAI3L,SAAJ,CAAc,wCAAd,CAAN;;;iBAGK6F,SAASqC,UAAT,CAAoBsE,MAApB,EAA4B1H,OAA5B,EAAkCqD,IAAlC,CAAuC,IAAvC,CAAP;;OANJ;;;;EAFgC9B;;ACApC,IAAMvB,SAAO,iBAAb;AACA,IAAM2H,yBAAyBhC,eAAe,CAC5C+B,MAD4C,CAAf,CAA/B;;;;;;;;IASqBE;;;;;;;;;;sCACO;aACjB;qBAAA,2BACY;;cAEXjI,SAASkH,UAAU,CAAV,CAAT,CAAJ,EAA4B;kBACpB,IAAI3L,SAAJ,CAAc,iDAAd,CAAN;;;iBAGK6F,SAASqC,UAAT,CAAoBwE,aAApB,EAAmC5H,MAAnC,EAAyC2H,sBAAzC,EACJtE,IADI,CACC,IADD,CAAP;;OAPJ;;;;EAFuCsE,uBAAuBpG,MAAvB;;ACX3C,IAAMvB,UAAO,oBAAb;;;;;;;;IAOqB6H;;;;;;;;;;sCACO;aACjB;uBAAA,2BACY3G,EADZ,EACgB;cACb4G,UAAU,gBAAgBpI,KAAhB,GAAwB,KAAKG,QAAQG,IAAb,CAAxB,GAA6C,EAA7D;;iBAEOe,SAASqC,UAAT,CAAoByE,eAApB,EAAqCC,UAAU9H,OAA/C,EACJqD,IADI,CACC,IADD,EACOnC,EADP,CAAP;;OAJJ;;;;EAFyCK;;ACJ7C,IAAMvB,UAAO,eAAb;;;;;;;;IAOqB+H;;;;;;;;;;sCACO;aACjB;kBAAA,sBACO7G,EADP,EACW;;cAEVvB,SAASkH,UAAU,CAAV,CAAT,CAAJ,EAA4B;kBACpB,IAAI3L,SAAJ,CAAc,8CAAd,CAAN;;;cAGI4M,UAAU,gBAAgBpI,KAAhB,GAAwB,KAAKG,QAAQG,IAAb,CAAxB,GAA6C,EAA7D;;iBAEOxF,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoB2E,UAApB,EAAgCD,UAAU9H,OAA1C,EAAgDqD,IAAhD,CAAqD,IAArD,EAA2DnC,EAA3D,CADK,EAEL;kBAAA,oBACmB;gDAANkD,IAAM;oBAAA;;;qBACR4D,WAAW3E,IAAX,oBAAgB,IAAhB,SAAyBe,IAAzB,EAAP;;WAJC,CAAP;;OATJ;;;;EAFoC7C;;AAwBxC,AAOA,SAASyG,UAAT,CAAqBtK,IAArB,EAAoC;;;qCAAN+F,IAAM;QAAA;;;MAC9BrF,MAAMC,OAAN,CAAcX,IAAd,CAAJ,EAAyB;QAClBpB,OADkB,GACPmH,IADO;;QAEnBuB,YAAY1I,OAAZ,KAAwBkC,WAAWlC,OAAX,CAA5B,EAAiD;gBACrC,EAAV;WACK2I,OAAL,CAAa3I,OAAb;;YAEMC,GAAR,GAAiB,KAAKyD,IAAtB;;;SAGK,kCAAS0B,SAAT,CAAmB4B,MAAnB,EAA0BD,IAA1B,+BAA+B,IAA/B,EAAqC3F,IAArC,SAA8C+F,IAA9C,EAAP;;;AChDF,IAAMzD,SAAO,eAAb;AACA,IAAMiI,uBAAuBtC,eAAe,CAC1CiC,aAD0C,EAE1CC,eAF0C,EAG1CE,UAH0C,CAAf,CAA7B;;;;;;;;IAWqBG;;;;;;;;;;;;;;;;;sCAOO;aACjB;mBAAA,uBACQhH,EADR,EACY;;cAEX,gBAAgBxB,KAApB,EAA2B;kBACnB,IAAIE,KAAJ,CAAU,0CAAV,CAAN;;;iBAGKmB,SAASqC,UAAT,CAAoB8E,WAApB,EAAiClI,MAAjC,EAAuCiI,oBAAvC,EACJ5E,IADI,CACC,IADD,EACOnC,EADP,CAAP;;OAPJ;;;;EARqC+G,qBAAqB1G,MAArB;;ACfzC,IAAMvB,SAAO,WAAb;AACA,IAAMmI,mBAAmBxC,eAAe,CACtCuC,WADsC,CAAf,CAAzB;;;;;;;;IASqBE;;;;;;;;;;;;;;;;;sCAOO;aACjB;iBACIrH,SAASqC,UAAT,CAAoBgF,OAApB,EAA6BpI,MAA7B,EAAmCmI,gBAAnC;OADX;;;;EARiCA,iBAAiB5G,MAAjB;;ACVrC,IAAMvB,UAAO,cAAb;;;;;;;;IAOqBqI;;;;;;;;;;;;;;;;;sCAOO;aACjB;kBAAA,wBACS;;cAER1I,SAASkH,UAAU,CAAV,CAAT,CAAJ,EAA4B;kBACpB,IAAI3L,SAAJ,CAAc,6CAAd,CAAN;;;;cAIE,gBAAgBwE,KAApB,EAA2B;kBACnB,IAAIE,KAAJ,CAAU,yCAAV,CAAN;;;iBAGKmB,SAASqC,UAAT,CAAoBiF,UAApB,EAAgCrI,OAAhC,EAAsCqD,IAAtC,CAA2C,IAA3C,CAAP;;OAZJ;;;;EARoC9B;;ACPxC,IAAMvB,UAAO,QAAb;AACA,IAAMsI,gBAAgB3C,eAAe,CACnC0C,UADmC,CAAf,CAAtB;;;;;;;;IASqBE;;;;;;;;;;;;;;;;;sCAOO;aACjB;cACCxH,SAASqC,UAAT,CAAoBmF,IAApB,EAA0BvI,OAA1B,EAAgCsI,aAAhC;OADR;;;;EAR8BA,cAAc/G,MAAd;;ACZlC,IAAMvB,UAAO,QAAb;;;;;;;;IAOqBwI;;;;;;;;;;;;;;;;;sCAOO;aACjB;cACCzH,SAASqC,UAAT,CAAoBoF,IAApB,EAA0BxI,OAA1B;OADR;;;;EAR8BuB;;ACNlC,IAAMvB,UAAO,QAAb;;;;;;;;IAOqByI;;;;;;;;;;;;;;;;;sCAOO;aACjB;YAAA,gBACCvH,EADD,EACK;;cAEJ,gBAAgBxB,KAApB,EAA2B;kBACnB,IAAIE,KAAJ,CAAU,yCAAV,CAAN;;;iBAGKmB,SAASqC,UAAT,CAAoBqF,IAApB,EAA0BzI,OAA1B,EAAgCqD,IAAhC,CAAqC,IAArC,EAA2CnC,EAA3C,CAAP;;OAPJ;;;;EAR8BK;;ACNlC,IAAMvB,UAAO,UAAb;AACA,IAAM0I,iBAAiB/C,eAAe,CACpC8C,IADoC,CAAf,CAAvB;;;;;;;;IASqBE;;;;;;;;;;;;;;;;;sCAOO;aACjB;eACE5H,SAASqC,UAAT,CAAoBuF,KAApB,EAA2B3I,OAA3B,EAAiC0I,cAAjC;OADT;;;;EAR+BA,eAAenH,MAAf;;ACZnC,IAAMvB,UAAO,SAAb;;;;;;;;IAOqB4I;;;;;;;;;;;;;;;;;sCAOO;aACjB;eACE7H,SAASqC,UAAT,CAAoBwF,KAApB,EAA2B5I,OAA3B;OADT;;;;EAR+BuB;;ACPnC,IAAMvB,UAAO,QAAb;;;;;;;;IAOqB6I;;;;;;;;;;;;;;;;;sCAOO;;;aAGjB;cACC9H,SAASqC,UAAT,CAAoByF,IAApB,EAA0B7I,OAA1B;OADR;;;;EAV8BuB;;ACKlC;;;;;AAKA,IAAMuH,iBAAiBnD,eAAe,CACpCgB,OADoC;AAEpCO,IAFoC;AAGpCE,UAHoC;AAIpCpD,MAJoC;AAKpCqD,UALoC;AAMpCe,OANoC;AAOpCG,IAPoC;AAQpCC,IARoC;AASpCG,KAToC;AAUpCC,KAVoC;AAWpCC,IAXoC;CAAf,CAAvB;;;;;;;;;;IAqBqBE;;;;;;;;;oBAONtL,MAAb,EAAgC;QAAXC,IAAW,uEAAJ,EAAI;;;mHACxBD,MADwB,EAChBC,IADgB;;UAGzBmC,QAAQC,IAAb,IAAqB,MAAKD,QAAQC,IAAb,EAClB/C,IADkB,CACb,kBAAU;YACTmE,EAAL,GAAU8H,OAAOC,KAAP,CAAa/H,EAAvB;YACKrB,QAAQG,IAAb,IAAqB,MAAKkJ,QAAL,EAArB;KAHiB,EAKlBnM,IALkB,CAKb,MAAKwK,IAAL,CAAU1F,IAAV,OALa,EAMlBzE,KANkB,CAMZ,YAAM;YACL,IAAIwC,KAAJ,CAAU,wCAAV,CAAN;KAPiB,CAArB;;;;;;;;;;;;;;;+BAkBU;6BACW,KAAKsB,EAA1B;;;;EA7BkC4H,eAAepJ,KAAf;;AC7BtC;;;;;AAKA,IAAMyJ,aAAaxD,eAAe,CAChCgB,OADgC;AAEhCO,IAFgC;AAGhCE,UAHgC;AAIhCpD,MAJgC;AAKhCqD,UALgC;AAMhCkB,IANgC;AAOhCK,KAPgC;CAAf,CAAnB;;;;;;;;;;;IAkBqBJ;;;;;;;;;gBAON/K,MAAb,EAAgC;QAAXC,IAAW,uEAAJ,EAAI;;;2GACxBD,MADwB,EAChBC,IADgB;;UAGzBmC,QAAQC,IAAb,IAAqB,MAAKD,QAAQC,IAAb,EAClB/C,IADkB,CACb,kBAAU;YACTmE,EAAL,GAAU8H,OAAOC,KAAP,CAAa/H,EAAvB;YACKrB,QAAQG,IAAb,IAAqB,MAAKkJ,QAAL,EAArB;KAHiB,EAKlBnM,IALkB,CAKb,MAAKwK,IAAL,CAAU1F,IAAV,OALa,EAMlBzE,KANkB,CAMZ,YAAM;YACL,IAAIwC,KAAJ,CAAU,oCAAV,CAAN;KAPiB,CAArB;;;;;;;;;;;;;;;;8DAkBYjD;;;;;;;uBAEJ,KAAKyM,eAAL;;;oBACFzM,QAAJ,EAAcA,SAAS,IAAT;;;;;;;;oBAEVA,QAAJ,EAAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAYN;yBACO,KAAKuE,EAAtB;;;;;;;;;;;;sCASiB;aACVzE,IAAI;aACJ,kBADI;gBAED,MAFC;gBAGD,KAAKgB;OAHR,CAAP;;;;EAxD8B0L,WAAWzJ,KAAX;;AC7BlC,IAAMM,UAAO,sBAAb;;;;;;;;;IAQqBmJ;;;;;;;;;;;sCAOO;aACjB;kBAAA,sBACOjI,EADP,EACW;iBACP1G,OAAOC,MAAP,CACLsG,SAASqC,UAAT,CAAoB+F,UAApB,EAAgCnJ,OAAhC,EAAsCqD,IAAtC,CAA2C,IAA3C,EAAiDnC,EAAjD,CADK,EAEL;kBAAA,oBACmB;gDAANkD,IAAM;oBAAA;;;qBACRiF,cAAchG,IAAd,uBAAmB,IAAnB,SAA4Be,IAA5B,EAAP;aAFJ;oBAAA,sBAIqB;iDAANA,IAAM;oBAAA;;;qBACVkF,UAASjG,IAAT,mBAAc,IAAd,SAAuBe,IAAvB,EAAP;;WAPC,CAAP;;OAFJ;;;;;;;;;;;;sBAuBW5C,QAAb,EAAkC;QAAX7D,IAAW,uEAAJ,EAAI;;;QAC1B4L,OAAO/O,OAAOC,MAAP,CAAc,EAAd,EAAkBkD,IAAlB,CAAb;QACI4L,KAAKC,YAAT,EAAuB;WAChBtI,EAAL,GAAUqI,KAAKC,YAAf;cACQ1L,cAAR,CAAuByL,IAAvB,EAA6B,cAA7B;;kHAEI/H,QAN0B,EAMhB+H,IANgB;;;;;;;;;;;;+BActB;aACHD,UAASjG,IAAT,CAAc,IAAd,EAAoB,KAAKoG,cAAzB,CAAP;;;;EA9CoClI;;AAkDxC,AAMA,SAAS8H,aAAT,GAAiC;qCAANjF,IAAM;QAAA;;;MACxB1G,IADwB,GAChB0G,IADgB;;MAE3B1G,QAAQA,KAAKgM,SAAjB,EAA4B;WACnBC,oBAAoBtG,IAApB,6BAAyB,IAAzB,SAAkCe,IAAlC,EAAP;GADF,MAEO;;;WACE,kCAAS1C,SAAT,CAAmB4B,MAAnB,EAA0BD,IAA1B,+BAA+B,IAA/B,SAAwCe,IAAxC,EAAP;;;;;;;;;;AAUJ,SAASkF,SAAT,CAAmBG,cAAnB,EAAmC;MAC7B,CAACA,cAAD,IAAmB,CAAC9J,SAAS8J,cAAT,CAAxB,EAAkD;UAC1C,IAAI7J,KAAJ,CAAU,mCAAV,CAAN;;;MAGE,KAAKoB,IAAL,KAAc,WAAlB,EAA+B;UACvB,IAAIpB,KAAJ,CAAU,qCAAV,CAAN;;;MAGE0B,QAAQ,KAAKA,KAAjB;MACItB,OAAO,KAAKA,IAAhB;;;MAGI,gBAAgBuB,MAApB,EAA4B;YAClB,KAAK1B,QAAQ2B,QAAb,EAAuBF,KAA/B;WACU,KAAKzB,QAAQ2B,QAAb,EAAuBxB,IAAjC,SAAyC,KAAKkB,EAA9C;;;;SAIKzE,IAAI;SACDuD,IAAR,cADS;YAED,MAFC;YAGDsB,MAAM7D,MAHL;UAIH,EAAEgM,8BAAF;GAJD,CAAP;;;;;;;;AAaF,SAASE,mBAAT,GAAgC;SACvBlN,IAAI;SACJ,KAAKuD,IADD;YAED,MAFC;YAGD;iBACK,IADL;KAHC;UAMH,EANG;YAOD,KAAKsB,KAAL,CAAW7D;GAPd,EASJV,IATI,CASC6M,gBAAgB/H,IAAhB,CAAqB,IAArB,CATD,CAAP;;;;AAaF,SAAS+H,eAAT,CAA0BZ,MAA1B,EAAkC;;;;;;;;ACxHlC;;;;;;;;;;;;;AAaA,IAAMa,oBAAoBlE,eAAe,CACvCgB,OADuC;AAEvC3C,MAFuC;AAGvCmF,YAHuC;AAIvCP,KAJuC;CAAf,CAA1B;;;;;;;;;;IAcqBV;;;;;;;;;uBAONzK,MAAb,EAAgC;QAAXC,IAAW,uEAAJ,EAAI;;;yHACxBD,MADwB,EAChBC,IADgB;;UAGzBmC,QAAQC,IAAb,IAAqB,MAAKD,QAAQC,IAAb,EAClB/C,IADkB,CACb,kBAAU;YACTmE,EAAL,GAAU8H,OAAOC,KAAP,CAAa/H,EAAvB;YACK4I,OAAL,GAAed,OAAOc,OAAtB;YACKjK,QAAQG,IAAb,IAAqB,MAAKkJ,QAAL,EAArB;KAJiB,EAMlBnM,IANkB,CAMb,MAAKwK,IAAL,CAAU1F,IAAV,OANa,EAOlBzE,KAPkB,CAOZ,YAAM;YACL,IAAIwC,KAAJ,CAAU,2CAAV,CAAN;KARiB,CAArB;;;;;;;;;;;;;;;;8DAmBWmK,aAAapN;;;;;;;;uBAEH,KAAKqN,iBAAL,CAAuBD,WAAvB;;;;4BACD,IAAIvB,MAAJ,CAASyB,KAAKjB,MAAL,CAAYvL,MAArB,EAA6BwM,IAA7B;;oBACdtN,QAAJ,EAAcA,SAAS,IAAT,EAAeuN,SAAf;iDACPA;;;;;;oBAEHvN,QAAJ,EAAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAaN;4BACU,KAAKmN,OAAzB,sBAAiD,KAAK5I,EAAtD;;;;;;;;;;;;;sCAUiB6I,aAAa;UAC1B,CAACA,WAAD,IAAgB,CAAC9O,cAAc8O,WAAd,CAArB,EAAiD;cACzC,IAAI7O,SAAJ,CAAc,0BAAd,CAAN;;;aAGKuB,IAAI;aACJ,cADI;gBAED,MAFC;cAGHsN,WAHG;gBAID,KAAKtM;OAJR,CAAP;;;;EAjEqCoM,kBAAkBnK,KAAlB;;AC1BzC;;;;;;;;;;;;;AAaA,IAAMmK,sBAAoBlE,eAAe,CACvCuB,IADuC;AAEvCE,UAFuC;AAGvCC,UAHuC;AAIvCmB,IAJuC;AAKvCX,eALuC;AAMvCE,UANuC;;;;;;CAAf,CAA1B;;;;;;;;;;IAqBqBoC;;;;;;;;;8BAON1M,MAAb,EAAgC;QAAXC,IAAW,uEAAJ,EAAI;;;uIACxBD,MADwB,EAChBC,IADgB;;UAGzBmC,QAAQC,IAAb,IAAqB,MAAKD,QAAQC,IAAb,EAClB/C,IADkB,CACb,kBAAU;YACTmE,EAAL,GAAU8H,OAAOC,KAAP,CAAa/H,EAAvB;YACK4I,OAAL,GAAed,OAAOc,OAAtB;YACKjK,QAAQG,IAAb,IAAqB,MAAKkJ,QAAL,EAArB;KAJiB,EAMlBnM,IANkB,CAMb,MAAKwK,IAAL,CAAU1F,IAAV,OANa,EAOlBzE,KAPkB,CAOZ,YAAM;YACL,IAAIwC,KAAJ,CAAU,2CAAV,CAAN;KARiB,CAArB;;;;;;;;;;;;;;;;8DAmBWmK,aAAapN;;;;;;;;uBAEH,KAAKqN,iBAAL,CAAuBD,WAAvB;;;;4BACD,IAAIvB,IAAJ,CAASyB,KAAKjB,MAAL,CAAYvL,MAArB,EAA6BwM,IAA7B;;oBACdtN,QAAJ,EAAcA,SAAS,IAAT,EAAeuN,SAAf;iDACPA;;;;;;oBAEHvN,QAAJ,EAAcA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAaN;4BACU,KAAKmN,OAAzB,sBAAiD,KAAK5I,EAAtD;;;;;;;;;;;;;sCAUiB6I,aAAa;UAC1B,CAACA,WAAD,IAAgB,CAAC9O,cAAc8O,WAAd,CAArB,EAAiD;cACzC,IAAI7O,SAAJ,CAAc,0BAAd,CAAN;;;aAGKuB,IAAI;aACJ,cADI;gBAED,MAFC;cAGHsN,WAHG;gBAID,KAAKtM;OAJR,CAAP;;;;EAjE4CoM,oBAAkB3B,aAAlB;;AC3ChD;AACA,AAGA;;;;;AAKA,IAAMkC,eAAezE,eAAe,CAClCzC,QADkC;AAElCc,MAFkC;;CAAf,CAArB;;;;;;;;;;IAaqBqG;;;;;;;;;kBAON5M,MAAb,EAAgC;QAAXC,IAAW,uEAAJ,EAAI;;;+GACxBD,MADwB,EAChBC,IADgB;;UAGzBmC,QAAQC,IAAb,IAAqB,MAAKD,QAAQC,IAAb,EAClB1C,KADkB,CACZ,YAAM;YACL,IAAIwC,KAAJ,CAAU,oCAAV,CAAN;KAFiB,EAIlB7C,IAJkB,CAIb,kBAAU;YACTmE,EAAL,GAAU8H,OAAOC,KAAP,CAAa/H,EAAvB;YACKrB,QAAQG,IAAb,IAAqB,MAAKkJ,QAAL,EAArB;KANiB,EAQlBnM,IARkB,CAQb,MAAKwK,IAAL,CAAU1F,IAAV,OARa,CAArB;;;;;;;;;;;;;;;+BAkBU;yBACO,KAAKX,EAAtB;;;;EA7BgCkJ,aAAa1K,KAAb;;ACVpC,eAAe;kBAAA;YAAA;wBAAA;oBAAA;gBAAA;wBAAA;0BAAA;YAAA;cAAA;oBAAA;wBAAA;kBAAA;YAAA;;CAAf;;ACfO,IAAM4K,UAAU,OAAhB;;;;;;;;;;;;;;;;;;;;;;;;;"}